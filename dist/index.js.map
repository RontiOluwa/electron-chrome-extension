{"version":3,"file":"index.js","mappings":"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M,GAAW,GAAG,EAAE,EAAEG,MAAyB,GAAG,GAAG,EAAE;EACzE,MAAMC,QAAQ,GAAGxhB,KAAK,CAACmI,OAAO,CAACoZ,MAAM,CAAC,GAAGA,MAAM,GAAG,CAACA,MAAM,CAAC;EAE1D,IAAIE,GAAG,GAAGL,GAAG;EACbI,QAAQ,CAAC7e,OAAO,CAAC4e,MAAM,IAAI;IACvB,IAAIE,GAAG,CAACld,UAAU,CAACgd,MAAM,CAAC,EAAEE,GAAG,GAAGA,GAAG,CAACrd,KAAK,CAACmd,MAAM,CAAC7e,MAAM,CAAC;EAC9D,CAAC,CAAC;EAEF,OAAO+e,GAAG;AACd;;;;;;;;;;;;;;;ACbO,MAAMhE,aAAa,GAAI/jB,IAAY,IAAM,OAAMA,IAAK,EAAC;;;;;;;;;;ACA5D;;AAEA;AACA;AACA;;AAEA,kBAAkB;AAClB,YAAY;AACZ,YAAY;AACZ,iBAAiB;AACjB,eAAe;AACf,eAAe;AACf;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;;AAED;AACA;AACA;;AAEA,cAAc;AACd;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EAAE;;AAEF;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAAW,4CAA4C;;AAEvD;AACA;AACA;AACA,WAAW,QAAQ;AACnB;AACA;AACA;AACA;AACA;AACA;AACA,IAAI;AACJ;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,YAAY,QAAQ;AACpB;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,YAAY;AACZ;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;;AAEA,iBAAiB,mBAAO,CAAC,oDAAU;;AAEnC,OAAO,YAAY;;AAEnB;AACA;AACA;;AAEA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;;;;;;;;;;;;AC3QA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,wBAAwB,mBAAO,CAAC,sCAAI;AACpC;;AAEA;AACA;AACA,EAAE;;AAEF;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,WAAW,QAAQ;AACnB,YAAY,eAAe;AAC3B;AACA;AACA;AACA;;AAEA,kBAAkB,sBAAsB;AACxC;AACA,cAAc;AACd;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA,WAAW,QAAQ;AACnB,YAAY;AACZ;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,IAAI;;AAEJ;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,uCAAuC;;AAEvC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,IAAI;AACJ;AACA;AACA;AACA,GAAG;;AAEH;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,WAAW,QAAQ;AACnB;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA,cAAc,SAAS;AACvB;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,YAAY,QAAQ;AACpB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,WAAW,QAAQ;AACnB,YAAY;AACZ;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA,8CAA8C,SAAS;AACvD;AACA;AACA;AACA;;AAEA,8CAA8C,SAAS;AACvD;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA,WAAW,QAAQ;AACnB,YAAY,QAAQ;AACpB;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,WAAW,OAAO;AAClB,YAAY;AACZ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA;;;;;;;;;;;ACjRA;AACA;AACA;AACA;;AAEA;AACA,CAAC,+FAAwC;AACzC,EAAE;AACF,CAAC,yFAAqC;AACtC;;;;;;;;;;;ACTA;AACA;AACA;;AAEA,YAAY,mBAAO,CAAC,gBAAK;AACzB,aAAa,mBAAO,CAAC,kBAAM;;AAE3B;AACA;AACA;;AAEA,YAAY;AACZ,WAAW;AACX,kBAAkB;AAClB,YAAY;AACZ,YAAY;AACZ,iBAAiB;AACjB,eAAe;AACf,SAAS;AACT;AACA;;AAEA;AACA;AACA;;AAEA,cAAc;;AAEd;AACA;AACA;AACA,uBAAuB,mBAAO,CAAC,8DAAgB;;AAE/C;AACA,EAAE,cAAc;AAChB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EAAE;AACF,6DAA6D;AAC7D;;AAEA;AACA;AACA;AACA;AACA;;AAEA,mBAAmB;AACnB;AACA,CAAC;AACD;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;;AAEH;AACA;AACA;AACA;AACA,GAAG;AACH;AACA,GAAG;AACH;AACA,GAAG;AACH;AACA;;AAEA;AACA;AACA,CAAC,IAAI;;AAEL;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA,QAAQ,4BAA4B;;AAEpC;AACA;AACA,iDAAiD,EAAE;AACnD,sBAAsB,WAAW,IAAI,MAAM;;AAE3C;AACA;AACA,GAAG;AACH;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA,WAAW,QAAQ;AACnB;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,YAAY,QAAQ;AACpB;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA,iBAAiB,iBAAiB;AAClC;AACA;AACA;;AAEA,iBAAiB,mBAAO,CAAC,oDAAU;;AAEnC,OAAO,YAAY;;AAEnB;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;;;;;;;;;;;ACtQa;;AAEb;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;ACPA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAAW,eAAe;AAC1B,WAAW,QAAQ;AACnB,YAAY,OAAO;AACnB,YAAY;AACZ;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,IAAI;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,WAAW,QAAQ;AACnB,YAAY;AACZ;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,WAAW,QAAQ;AACnB,YAAY;AACZ;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,WAAW,QAAQ;AACnB,YAAY;AACZ;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;;;;;;;;;;;ACjKa;AACb,WAAW,mBAAO,CAAC,cAAI;AACvB,YAAY,mBAAO,CAAC,gBAAK;AACzB,gBAAgB,mBAAO,CAAC,kDAAU;;AAElC,OAAO,KAAK;;AAEZ;AACA;AACA;AACA;AACA;AACA;AACA,EAAE;AACF;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,oCAAoC,gCAAgC,IAAI;AACxE;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA,iCAAiC,GAAG;AACpC;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA,6CAA6C;AAC7C;AACA;AACA;AACA,EAAE;;AAEF;AACA;;AAEA;AACA;AACA,0BAA0B,qBAAqB;AAC/C,0BAA0B,qBAAqB;AAC/C;;;;;;;;;;;;ACvJA;;;;;;;;;;;ACAA;;;;;;;;;;;ACAA;;;;;;;;;;;ACAA;;;;;;;;;;;ACAA;;;;;;;;;;;ACAA;;;;;;;;;;;ACAA;;;;;;;;;;;ACAA;;;;;;;;;;;ACAA;;;;;;UCAA;UACA;;UAEA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;;UAEA;UACA;;UAEA;UACA;UACA;;;;;WCtBA;WACA;WACA;WACA;WACA;WACA,iCAAiC,WAAW;WAC5C;WACA;;;;;WCPA;WACA;WACA;WACA;WACA,yCAAyC,wCAAwC;WACjF;WACA;WACA;;;;;WCPA;;;;;WCAA;WACA;WACA;WACA,uDAAuD,iBAAiB;WACxE;WACA,gDAAgD,aAAa;WAC7D","sources":["webpack://electron-chrome-extensions-test/./src/browser/api/browser-action.ts","webpack://electron-chrome-extensions-test/./src/browser/api/commands.ts","webpack://electron-chrome-extensions-test/./src/browser/api/common.ts","webpack://electron-chrome-extensions-test/./src/browser/api/context-menus.ts","webpack://electron-chrome-extensions-test/./src/browser/api/cookies.ts","webpack://electron-chrome-extensions-test/./src/browser/api/notifications.ts","webpack://electron-chrome-extensions-test/./src/browser/api/runtime.ts","webpack://electron-chrome-extensions-test/./src/browser/api/tabs.ts","webpack://electron-chrome-extensions-test/./src/browser/api/web-navigation.ts","webpack://electron-chrome-extensions-test/./src/browser/api/windows.ts","webpack://electron-chrome-extensions-test/./src/browser/index.ts","webpack://electron-chrome-extensions-test/./src/browser/popup.ts","webpack://electron-chrome-extensions-test/./src/browser/router.ts","webpack://electron-chrome-extensions-test/./src/browser/store.ts","webpack://electron-chrome-extensions-test/./src/browser/utils.ts","webpack://electron-chrome-extensions-test/./src/isomorphic/ipc.ts","webpack://electron-chrome-extensions-test/./node_modules/debug/src/browser.js","webpack://electron-chrome-extensions-test/./node_modules/debug/src/common.js","webpack://electron-chrome-extensions-test/./node_modules/debug/src/index.js","webpack://electron-chrome-extensions-test/./node_modules/debug/src/node.js","webpack://electron-chrome-extensions-test/./node_modules/has-flag/index.js","webpack://electron-chrome-extensions-test/./node_modules/ms/index.js","webpack://electron-chrome-extensions-test/./node_modules/supports-color/index.js","webpack://electron-chrome-extensions-test/external node-commonjs \"electron\"","webpack://electron-chrome-extensions-test/external node-commonjs \"events\"","webpack://electron-chrome-extensions-test/external node-commonjs \"fs\"","webpack://electron-chrome-extensions-test/external node-commonjs \"node:path\"","webpack://electron-chrome-extensions-test/external node-commonjs \"node:url\"","webpack://electron-chrome-extensions-test/external node-commonjs \"os\"","webpack://electron-chrome-extensions-test/external node-commonjs \"path\"","webpack://electron-chrome-extensions-test/external node-commonjs \"tty\"","webpack://electron-chrome-extensions-test/external node-commonjs \"util\"","webpack://electron-chrome-extensions-test/webpack/bootstrap","webpack://electron-chrome-extensions-test/webpack/runtime/compat get default export","webpack://electron-chrome-extensions-test/webpack/runtime/define property getters","webpack://electron-chrome-extensions-test/webpack/runtime/hasOwnProperty shorthand","webpack://electron-chrome-extensions-test/webpack/runtime/make namespace object","webpack://electron-chrome-extensions-test/./src/index.ts"],"sourcesContent":["import { Menu, MenuItem, protocol, nativeImage, app } from 'electron'\nimport { ExtensionContext } from '../context'\nimport { PopupView } from '../popup'\nimport { ExtensionEvent } from '../router'\nimport {\n  getExtensionUrl,\n  getExtensionManifest,\n  getIconPath,\n  resolveExtensionPath,\n  matchSize,\n  ResizeType,\n} from './common'\n\nconst debug = require('debug')('electron-chrome-extensions:browserAction')\n\nif (!app.isReady()) {\n  protocol.registerSchemesAsPrivileged([{ scheme: 'crx', privileges: { bypassCSP: true } }])\n}\n\ninterface ExtensionAction {\n  color?: string\n  text?: string\n  title?: string\n  icon?: chrome.browserAction.TabIconDetails\n  popup?: string\n  /** Last modified date for icon. */\n  iconModified?: number\n}\n\ntype ExtensionActionKey = keyof ExtensionAction\n\ninterface ActivateDetails {\n  eventType: string\n  extensionId: string\n  tabId: number\n  anchorRect: { x: number; y: number; width: number; height: number }\n}\n\nconst getBrowserActionDefaults = (extension: Electron.Extension): ExtensionAction | undefined => {\n  const manifest = getExtensionManifest(extension)\n  const { browser_action } = manifest\n  if (typeof browser_action === 'object') {\n    const action: ExtensionAction = {}\n\n    action.title = browser_action.default_title || manifest.name\n\n    const iconPath = getIconPath(extension)\n    if (iconPath) action.icon = { path: iconPath }\n\n    if (browser_action.default_popup) {\n      action.popup = browser_action.default_popup\n    }\n\n    return action\n  }\n}\n\ninterface ExtensionActionStore extends Partial<ExtensionAction> {\n  tabs: { [key: string]: ExtensionAction }\n}\n\nexport class BrowserActionAPI {\n  private actionMap = new Map</* extensionId */ string, ExtensionActionStore>()\n  private popup?: PopupView\n\n  private observers: Set<Electron.WebContents> = new Set()\n  private queuedUpdate: boolean = false\n\n  constructor(private ctx: ExtensionContext) {\n    const handle = this.ctx.router.apiHandler()\n\n    const getter =\n      (propName: ExtensionActionKey) =>\n      ({ extension }: ExtensionEvent, details: chrome.browserAction.TabDetails = {}) => {\n        const { tabId } = details\n        const action = this.getAction(extension.id)\n\n        let result\n\n        if (tabId) {\n          if (action.tabs[tabId]) {\n            result = action.tabs[tabId][propName]\n          } else {\n            result = action[propName]\n          }\n        } else {\n          result = action[propName]\n        }\n\n        return result\n      }\n\n    const setDetails = (\n      { extension }: ExtensionEvent,\n      details: any,\n      propName: ExtensionActionKey\n    ) => {\n      const { tabId } = details\n      let value = (details as any)[propName] || undefined\n\n      if (typeof value === 'undefined') {\n        const defaults = getBrowserActionDefaults(extension)\n        value = defaults ? defaults[propName] : value\n      }\n\n      const valueObj = { [propName]: value }\n      const action = this.getAction(extension.id)\n\n      if (tabId) {\n        const tabAction = action.tabs[tabId] || (action.tabs[tabId] = {})\n        Object.assign(tabAction, valueObj)\n      } else {\n        Object.assign(action, valueObj)\n      }\n\n      this.onUpdate()\n    }\n\n    const setter =\n      (propName: ExtensionActionKey) =>\n      (event: ExtensionEvent, details: chrome.browserAction.TabDetails) =>\n        setDetails(event, details, propName)\n\n    const handleProp = (prop: string, key: ExtensionActionKey) => {\n      handle(`browserAction.get${prop}`, getter(key))\n      handle(`browserAction.set${prop}`, setter(key))\n    }\n\n    handleProp('BadgeBackgroundColor', 'color')\n    handleProp('BadgeText', 'text')\n    handleProp('Title', 'title')\n    handleProp('Popup', 'popup')\n\n    // setIcon is unique in that it can pass in a variety of properties. Here we normalize them\n    // to use 'icon'.\n    handle(\n      'browserAction.setIcon',\n      (event, { tabId, ...details }: chrome.browserAction.TabIconDetails) => {\n        setDetails(event, { tabId, icon: details }, 'icon')\n        setDetails(event, { tabId, iconModified: Date.now() }, 'iconModified')\n      }\n    )\n\n    // browserAction preload API\n    const preloadOpts = { allowRemote: true, extensionContext: false }\n    handle('browserAction.getState', this.getState.bind(this), preloadOpts)\n    handle('browserAction.activate', this.activate.bind(this), preloadOpts)\n    handle(\n      'browserAction.addObserver',\n      (event) => {\n        const { sender: webContents } = event\n        this.observers.add(webContents)\n        webContents.once('destroyed', () => {\n          this.observers.delete(webContents)\n        })\n      },\n      preloadOpts\n    )\n    handle(\n      'browserAction.removeObserver',\n      (event) => {\n        const { sender: webContents } = event\n        this.observers.delete(webContents)\n      },\n      preloadOpts\n    )\n\n    this.ctx.store.on('active-tab-changed', () => {\n      this.onUpdate()\n    })\n\n    // Clear out tab details when removed\n    this.ctx.store.on('tab-removed', (tabId: number) => {\n      for (const [, actionDetails] of this.actionMap) {\n        if (actionDetails.tabs[tabId]) {\n          delete actionDetails.tabs[tabId]\n        }\n      }\n      this.onUpdate()\n    })\n\n    this.setupSession(this.ctx.session)\n  }\n\n  private setupSession(session: Electron.Session) {\n    session.on('extension-loaded', (event, extension) => {\n      this.processExtension(extension)\n    })\n\n    session.on('extension-unloaded', (event, extension) => {\n      this.removeActions(extension.id)\n    })\n\n    session.protocol.registerBufferProtocol('crx', this.handleCrxRequest)\n  }\n\n  private handleCrxRequest = (\n    request: Electron.ProtocolRequest,\n    callback: (response: Electron.ProtocolResponse) => void\n  ) => {\n    debug('%s', request.url)\n\n    let response: Electron.ProtocolResponse\n\n    try {\n      const url = new URL(request.url)\n      const { hostname: requestType } = url\n\n      switch (requestType) {\n        case 'extension-icon': {\n          const tabId = url.searchParams.get('tabId')\n\n          const fragments = url.pathname.split('/')\n          const extensionId = fragments[1]\n          const imageSize = parseInt(fragments[2], 10)\n          const resizeType = parseInt(fragments[3], 10) || ResizeType.Up\n\n          const extension = this.ctx.session.getExtension(extensionId)\n\n          let iconDetails: chrome.browserAction.TabIconDetails | undefined\n\n          const action = this.actionMap.get(extensionId)\n          if (action) {\n            iconDetails = (tabId && action.tabs[tabId]?.icon) || action.icon\n          }\n\n          let iconImage\n\n          if (extension && iconDetails) {\n            if (typeof iconDetails.path === 'string') {\n              const iconAbsPath = resolveExtensionPath(extension, iconDetails.path)\n              if (iconAbsPath) iconImage = nativeImage.createFromPath(iconAbsPath)\n            } else if (typeof iconDetails.path === 'object') {\n              const imagePath = matchSize(iconDetails.path, imageSize, resizeType)\n              const iconAbsPath = imagePath && resolveExtensionPath(extension, imagePath)\n              if (iconAbsPath) iconImage = nativeImage.createFromPath(iconAbsPath)\n            } else if (typeof iconDetails.imageData === 'string') {\n              iconImage = nativeImage.createFromDataURL(iconDetails.imageData)\n            } else if (typeof iconDetails.imageData === 'object') {\n              const imageData = matchSize(iconDetails.imageData as any, imageSize, resizeType)\n              iconImage = imageData ? nativeImage.createFromDataURL(imageData) : undefined\n            }\n          }\n\n          if (iconImage) {\n            response = {\n              statusCode: 200,\n              mimeType: 'image/png',\n              data: iconImage.toPNG(),\n            }\n          } else {\n            response = { statusCode: 400 }\n          }\n\n          break\n        }\n        default: {\n          response = { statusCode: 400 }\n        }\n      }\n    } catch (e) {\n      console.error(e)\n\n      response = {\n        statusCode: 500,\n      }\n    }\n\n    callback(response)\n  }\n\n  private getAction(extensionId: string) {\n    let action = this.actionMap.get(extensionId)\n    if (!action) {\n      action = { tabs: {} }\n      this.actionMap.set(extensionId, action)\n      this.onUpdate()\n    }\n\n    return action\n  }\n\n  // TODO: Make private for v4 major release.\n  removeActions(extensionId: string) {\n    if (this.actionMap.has(extensionId)) {\n      this.actionMap.delete(extensionId)\n    }\n\n    this.onUpdate()\n  }\n\n  private getPopupUrl(extensionId: string, tabId: number) {\n    const action = this.getAction(extensionId)\n    const popupPath = action.tabs[tabId]?.popup || action.popup || undefined\n    return popupPath && `chrome-extension://${extensionId}/${popupPath}`\n  }\n\n  // TODO: Make private for v4 major release.\n  processExtension(extension: Electron.Extension) {\n    const defaultAction = getBrowserActionDefaults(extension)\n    if (defaultAction) {\n      const action = this.getAction(extension.id)\n      Object.assign(action, defaultAction)\n    }\n  }\n\n  private getState() {\n    // Get state without icon data.\n    const actions = Array.from(this.actionMap.entries()).map(([id, details]) => {\n      const { icon, tabs, ...rest } = details\n\n      const tabsInfo: { [key: string]: any } = {}\n\n      for (const tabId of Object.keys(tabs)) {\n        const { icon, ...rest } = tabs[tabId]\n        tabsInfo[tabId] = rest\n      }\n\n      return {\n        id,\n        tabs: tabsInfo,\n        ...rest,\n      }\n    })\n\n    const activeTab = this.ctx.store.getActiveTabOfCurrentWindow()\n    return { activeTabId: activeTab?.id, actions }\n  }\n\n  private activate(extEvt: ExtensionEvent, details: ActivateDetails) {\n    const { eventType, extensionId, tabId } = details\n\n    debug(\n      `activate [eventType: ${eventType}, extensionId: '${extensionId}', tabId: ${tabId}, senderId: ${extEvt.sender.id}]`\n    )\n\n    switch (eventType) {\n      case 'click':\n        this.activateClick(details)\n        break\n      case 'contextmenu':\n        this.activateContextMenu(details, extEvt)\n        break\n      default:\n        console.debug(`Ignoring unknown browserAction.activate event '${eventType}'`)\n    }\n  }\n\n  private activateClick(details: ActivateDetails) {\n    const { extensionId, tabId, anchorRect } = details\n\n    if (this.popup) {\n      const toggleExtension = !this.popup.isDestroyed() && this.popup.extensionId === extensionId\n      this.popup.destroy()\n      this.popup = undefined\n      if (toggleExtension) {\n        debug('skipping activate to close popup')\n        return\n      }\n    }\n\n    const tab =\n      tabId >= 0 ? this.ctx.store.getTabById(tabId) : this.ctx.store.getActiveTabOfCurrentWindow()\n    if (!tab) {\n      throw new Error(`Unable to get active tab`)\n    }\n\n    const popupUrl = this.getPopupUrl(extensionId, tab.id)\n\n    if (popupUrl) {\n      const win = this.ctx.store.tabToWindow.get(tab)\n      if (!win) {\n        throw new Error('Unable to get BrowserWindow from active tab')\n      }\n\n      this.popup = new PopupView({\n        extensionId,\n        session: this.ctx.session,\n        parent: win,\n        url: popupUrl,\n        anchorRect,\n      })\n\n      debug(`opened popup: ${popupUrl}`)\n\n      this.ctx.emit('browser-action-popup-created', this.popup)\n    } else {\n      debug(`dispatching onClicked for ${extensionId}`)\n\n      const tabDetails = this.ctx.store.tabDetailsCache.get(tab.id)\n      this.ctx.router.sendEvent(extensionId, 'browserAction.onClicked', tabDetails)\n    }\n  }\n\n  private activateContextMenu(details: ActivateDetails, event: ExtensionEvent) {\n    const { extensionId, anchorRect } = details\n\n    const extension = this.ctx.session.getExtension(extensionId)\n    if (!extension) {\n      throw new Error(`Unregistered extension '${extensionId}'`)\n    }\n\n    const manifest = getExtensionManifest(extension)\n    const menu = new Menu()\n    const append = (opts: Electron.MenuItemConstructorOptions) => menu.append(new MenuItem(opts))\n    const appendSeparator = () => menu.append(new MenuItem({ type: 'separator' }))\n\n    append({\n      label: extension.name,\n      click: () => {\n        const homePageUrl =\n          manifest.homepage_url || `https://chrome.google.com/webstore/detail/${extension.id}`\n        this.ctx.store.createTab({ url: homePageUrl }, event)\n      },\n    })\n\n    appendSeparator()\n\n    const contextMenuItems: MenuItem[] = this.ctx.store.buildMenuItems(\n      extensionId,\n      'browser_action'\n    )\n    if (contextMenuItems.length > 0) {\n      contextMenuItems.forEach((item) => menu.append(item))\n      appendSeparator()\n    }\n\n    const optionsPage = manifest.options_page || manifest.options_ui?.page\n    const optionsPageUrl = optionsPage ? getExtensionUrl(extension, optionsPage) : undefined\n\n    append({\n      label: 'Options',\n      enabled: typeof optionsPageUrl === 'string',\n      click: () => {\n        this.ctx.store.createTab({ url: optionsPageUrl }, event)\n      },\n    })\n\n    menu.popup({\n      x: Math.floor(anchorRect.x),\n      y: Math.floor(anchorRect.y + anchorRect.height),\n    })\n  }\n\n  private onUpdate() {\n    if (this.queuedUpdate) return\n    this.queuedUpdate = true\n    queueMicrotask(() => {\n      this.queuedUpdate = false\n      debug(`dispatching update to ${this.observers.size} observer(s)`)\n      Array.from(this.observers).forEach((observer) => {\n        if (!observer.isDestroyed()) {\n          observer.send('browserAction.update')\n        }\n      })\n    })\n  }\n}\n","import { ExtensionContext } from '../context'\n\n/**\n * Stub implementation for chrome.commands API.\n */\nexport class CommandsAPI {\n  constructor(private ctx: ExtensionContext) {\n    const handle = this.ctx.router.apiHandler()\n    handle('commands.getAll', this.getAll)\n  }\n\n  getAll() {\n    return []\n  }\n}\n","import { promises as fs } from 'fs'\nimport * as path from 'path'\nimport { nativeImage } from 'electron'\n\nexport interface TabContents extends Electron.WebContents {\n  favicon?: string\n}\n\nexport type ContextMenuType =\n  | 'all'\n  | 'page'\n  | 'frame'\n  | 'selection'\n  | 'link'\n  | 'editable'\n  | 'image'\n  | 'video'\n  | 'audio'\n  | 'launcher'\n  | 'browser_action'\n  | 'page_action'\n  | 'action'\n\n/**\n * Get the extension's properly typed Manifest.\n *\n * I can't seem to get TS's merged type declarations working so I'm using this\n * instead for now.\n */\nexport const getExtensionManifest = (extension: Electron.Extension): chrome.runtime.Manifest =>\n  extension.manifest\n\nexport const getExtensionUrl = (extension: Electron.Extension, uri: string) => {\n  try {\n    return new URL(uri, extension.url).href\n  } catch {}\n}\n\nexport const resolveExtensionPath = (extension: Electron.Extension, uri: string) => {\n  const relpath = uri.indexOf(extension.url) === 0 ? uri.slice(extension.url.length) : uri;\n  const resPath = path.join(extension.path, relpath);\n\n  // prevent any parent traversals\n  if (!resPath.startsWith(extension.path)) return\n\n  return resPath\n}\n\nexport const validateExtensionResource = async (extension: Electron.Extension, uri: string) => {\n  const resPath = resolveExtensionPath(extension, uri)\n  if (!resPath) return\n\n  try {\n    await fs.stat(resPath)\n  } catch {\n    return // doesn't exist\n  }\n\n  return resPath\n}\n\nexport enum ResizeType {\n  Exact,\n  Up,\n  Down,\n}\n\nexport const matchSize = (\n  imageSet: { [key: number]: string },\n  size: number,\n  match: ResizeType\n): string | undefined => {\n  // TODO: match based on size\n  const first = parseInt(Object.keys(imageSet).pop()!, 10)\n  return imageSet[first]\n}\n\n/** Gets the relative path to the extension's default icon. */\nexport const getIconPath = (\n  extension: Electron.Extension,\n  iconSize: number = 32,\n  resizeType = ResizeType.Up\n) => {\n  const { browser_action, icons } = getExtensionManifest(extension)\n  const { default_icon } = browser_action || {}\n\n  if (typeof default_icon === 'string') {\n    const iconPath = default_icon\n    return iconPath\n  } else if (typeof default_icon === 'object') {\n    const iconPath = matchSize(default_icon, iconSize, resizeType)\n    return iconPath\n  } else if (typeof icons === 'object') {\n    const iconPath = matchSize(icons, iconSize, resizeType)\n    return iconPath\n  }\n}\n\nexport const getIconImage = (extension: Electron.Extension) => {\n  const iconPath = getIconPath(extension)\n  const iconAbsolutePath = iconPath && resolveExtensionPath(extension, iconPath)\n  return iconAbsolutePath ? nativeImage.createFromPath(iconAbsolutePath) : undefined\n}\n\nconst escapePattern = (pattern: string) => pattern.replace(/[\\\\^$+?.()|[\\]{}]/g, '\\\\$&')\n\n/**\n * @see https://developer.chrome.com/extensions/match_patterns\n */\nexport const matchesPattern = (pattern: string, url: string) => {\n  if (pattern === '<all_urls>') return true\n  const regexp = new RegExp(`^${pattern.split('*').map(escapePattern).join('.*')}$`)\n  return url.match(regexp)\n}\n","import { Menu, MenuItem } from 'electron'\nimport { MenuItemConstructorOptions } from 'electron/main'\nimport { ExtensionContext } from '../context'\nimport { ExtensionEvent } from '../router'\nimport { ContextMenuType, getIconImage, matchesPattern } from './common'\n\ntype ContextItemProps = chrome.contextMenus.CreateProperties & { id: string }\n\ntype ContextItemConstructorOptions = {\n  extension: Electron.Extension\n  props: ContextItemProps\n  webContents: Electron.WebContents\n  params?: Electron.ContextMenuParams\n  showIcon?: boolean\n}\n\nconst DEFAULT_CONTEXTS = ['page']\n\nconst getContextTypesFromParams = (params: Electron.ContextMenuParams): Set<ContextMenuType> => {\n  const contexts = new Set<ContextMenuType>(['all'])\n\n  switch (params.mediaType) {\n    case 'audio':\n    case 'video':\n    case 'image':\n      contexts.add(params.mediaType)\n  }\n\n  if (params.pageURL) contexts.add('page')\n  if (params.linkURL) contexts.add('link')\n  if (params.frameURL) contexts.add('frame')\n  if (params.selectionText) contexts.add('selection')\n  if (params.isEditable) contexts.add('editable')\n\n  return contexts\n}\n\nconst formatTitle = (title: string, params: Electron.ContextMenuParams) => {\n  if (params.selectionText && title.includes('%s')) {\n    title = title.split('%s').join(params.selectionText)\n  }\n  return title\n}\n\nconst matchesConditions = (\n  props: ContextItemProps,\n  conditions: {\n    contextTypes: Set<ContextMenuType>\n    targetUrl?: string\n    documentUrl?: string\n  }\n) => {\n  if (props.visible === false) return false\n\n  const { contextTypes, targetUrl, documentUrl } = conditions\n\n  const contexts = props.contexts || DEFAULT_CONTEXTS\n  const inContext = contexts.some((context) => contextTypes.has(context as ContextMenuType))\n  if (!inContext) return false\n\n  if (props.targetUrlPatterns && props.targetUrlPatterns.length > 0 && targetUrl) {\n    if (!props.targetUrlPatterns.some((pattern) => matchesPattern(pattern, targetUrl))) {\n      return false\n    }\n  }\n\n  if (props.documentUrlPatterns && props.documentUrlPatterns.length > 0 && documentUrl) {\n    if (!props.documentUrlPatterns.some((pattern) => matchesPattern(pattern, documentUrl))) {\n      return false\n    }\n  }\n\n  return true\n}\n\nexport class ContextMenusAPI {\n  private menus = new Map<\n    /* extensionId */ string,\n    Map</* menuItemId */ string, ContextItemProps>\n  >()\n\n  constructor(private ctx: ExtensionContext) {\n    const handle = this.ctx.router.apiHandler()\n    handle('contextMenus.create', this.create)\n    handle('contextMenus.remove', this.remove)\n    handle('contextMenus.removeAll', this.removeAll)\n\n    this.ctx.session.on('extension-unloaded', (event, extension) => {\n      if (this.menus.has(extension.id)) {\n        this.menus.delete(extension.id)\n      }\n    })\n\n    this.ctx.store.buildMenuItems = this.buildMenuItemsForExtension.bind(this)\n  }\n\n  private addContextItem(extensionId: string, props: ContextItemProps) {\n    let contextItems = this.menus.get(extensionId)\n    if (!contextItems) {\n      contextItems = new Map()\n      this.menus.set(extensionId, contextItems)\n    }\n    contextItems.set(props.id, props)\n  }\n\n  private buildMenuItem = (opts: ContextItemConstructorOptions) => {\n    const { extension, props, webContents, params } = opts\n\n    // TODO: try to get the appropriately sized image before resizing\n    let icon = opts.showIcon ? getIconImage(extension) : undefined\n    if (icon) {\n      icon = icon.resize({ width: 16, height: 16 })\n    }\n\n    const menuItemOptions: MenuItemConstructorOptions = {\n      id: props.id,\n      type: props.type as any,\n      label: params ? formatTitle(props.title || '', params) : props.title || '',\n      icon,\n      enabled: props.enabled,\n      click: () => {\n        this.onClicked(extension.id, props.id, webContents, params)\n      },\n    }\n\n    return menuItemOptions\n  }\n\n  private buildMenuItemsFromTemplate = (menuItemTemplates: ContextItemConstructorOptions[]) => {\n    const itemMap = new Map<string, MenuItemConstructorOptions>()\n\n    // Group by ID\n    for (const item of menuItemTemplates) {\n      const menuItem = this.buildMenuItem(item)\n      itemMap.set(item.props.id, menuItem)\n    }\n\n    // Organize in tree\n    for (const item of menuItemTemplates) {\n      const menuItem = itemMap.get(item.props.id)\n      if (item.props.parentId) {\n        const parentMenuItem = itemMap.get(item.props.parentId)\n        if (parentMenuItem) {\n          const submenu = (parentMenuItem.submenu || []) as Electron.MenuItemConstructorOptions[]\n          submenu.push(menuItem!)\n          parentMenuItem.submenu = submenu\n        }\n      }\n    }\n\n    const menuItems: Electron.MenuItem[] = []\n\n    const buildFromTemplate = (opts: Electron.MenuItemConstructorOptions) => {\n      if (Array.isArray(opts.submenu)) {\n        const submenu = new Menu()\n        opts.submenu.forEach((item) => submenu.append(buildFromTemplate(item)))\n        opts.submenu = submenu\n      }\n      return new MenuItem(opts)\n    }\n\n    // Build all final MenuItems in-order\n    for (const item of menuItemTemplates) {\n      // Items with parents will be handled recursively\n      if (item.props.parentId) continue\n\n      const menuItem = itemMap.get(item.props.id)!\n      menuItems.push(buildFromTemplate(menuItem))\n    }\n\n    return menuItems\n  }\n\n  buildMenuItemsForParams(\n    webContents: Electron.WebContents,\n    params: Electron.ContextMenuParams\n  ): Electron.MenuItem[] {\n    if (webContents.session !== this.ctx.session) return []\n\n    const menuItemOptions = []\n\n    const conditions = {\n      contextTypes: getContextTypesFromParams(params),\n      targetUrl: params.srcURL || params.linkURL,\n      documentUrl: params.frameURL || params.pageURL,\n    }\n\n    for (const [extensionId, propItems] of this.menus) {\n      const extension = this.ctx.session.getExtension(extensionId)\n      if (!extension) continue\n\n      for (const [, props] of propItems) {\n        if (matchesConditions(props, conditions)) {\n          const menuItem = {\n            extension,\n            props,\n            webContents,\n            params,\n            showIcon: true,\n          }\n          menuItemOptions.push(menuItem)\n        }\n      }\n    }\n\n    return this.buildMenuItemsFromTemplate(menuItemOptions)\n  }\n\n  private buildMenuItemsForExtension(\n    extensionId: string,\n    menuType: ContextMenuType\n  ): Electron.MenuItem[] {\n    const extensionItems = this.menus.get(extensionId)\n    const extension = this.ctx.session.getExtension(extensionId)\n    const activeTab = this.ctx.store.getActiveTabOfCurrentWindow()\n\n    const menuItemOptions = []\n\n    if (extensionItems && extension && activeTab) {\n      const conditions = {\n        contextTypes: new Set<ContextMenuType>(['all', menuType]),\n      }\n\n      for (const [, props] of extensionItems) {\n        if (matchesConditions(props, conditions)) {\n          const menuItem = { extension, props, webContents: activeTab }\n          menuItemOptions.push(menuItem)\n        }\n      }\n    }\n\n    return this.buildMenuItemsFromTemplate(menuItemOptions)\n  }\n\n  private create = ({ extension }: ExtensionEvent, createProperties: ContextItemProps) => {\n    const { id, type, title } = createProperties\n\n    if (this.menus.has(id)) {\n      // TODO: duplicate error\n      return\n    }\n\n    if (!title && type !== 'separator') {\n      // TODO: error\n      return\n    }\n\n    this.addContextItem(extension.id, createProperties)\n  }\n\n  private remove = ({ extension }: ExtensionEvent, menuItemId: string) => {\n    const items = this.menus.get(extension.id)\n    if (items && items.has(menuItemId)) {\n      items.delete(menuItemId)\n      if (items.size === 0) {\n        this.menus.delete(extension.id)\n      }\n    }\n  }\n\n  private removeAll = ({ extension }: ExtensionEvent) => {\n    this.menus.delete(extension.id)\n  }\n\n  private onClicked(\n    extensionId: string,\n    menuItemId: string,\n    webContents: Electron.WebContents,\n    params?: Electron.ContextMenuParams\n  ) {\n    if (webContents.isDestroyed()) return\n\n    const tab = this.ctx.store.tabDetailsCache.get(webContents.id)\n    if (!tab) {\n      console.error(`[Extensions] Unable to find tab for id=${webContents.id}`)\n      return\n    }\n\n    const data: chrome.contextMenus.OnClickData = {\n      selectionText: params?.selectionText,\n      checked: false, // TODO\n      menuItemId,\n      frameId: -1, // TODO: match frameURL with webFrameMain in Electron 12\n      frameUrl: params?.frameURL,\n      editable: params?.isEditable || false,\n      mediaType: params?.mediaType,\n      wasChecked: false, // TODO\n      pageUrl: params?.pageURL as any, // types are inaccurate\n      linkUrl: params?.linkURL,\n      parentMenuItemId: -1, // TODO\n      srcUrl: params?.srcURL,\n    }\n\n    this.ctx.router.sendEvent(extensionId, 'contextMenus.onClicked', data, tab)\n  }\n}\n","import { ExtensionContext } from '../context';\nimport { ExtensionEvent } from '../router';\n\nenum CookieStoreID {\n    Default = '0',\n    Incognito = '1',\n}\n\nconst onChangedCauseTranslation: { [key: string]: string } = {\n    'expired-overwrite': 'expired_overwrite',\n};\n\nconst createCookieDetails = (\n    cookie: Electron.Cookie\n): chrome.cookies.Cookie => ({\n    ...cookie,\n    domain: cookie.domain || '',\n    hostOnly: Boolean(cookie.hostOnly),\n    session: Boolean(cookie.session),\n    path: cookie.path || '',\n    httpOnly: Boolean(cookie.httpOnly),\n    secure: Boolean(cookie.secure),\n    storeId: CookieStoreID.Default,\n});\n\nexport class CookiesAPI {\n    private get cookies() {\n        return this.ctx.session.cookies;\n    }\n\n    constructor(private ctx: ExtensionContext) {\n        const handle = this.ctx.router.apiHandler();\n        handle('cookies.get', this.get.bind(this));\n        handle('cookies.getAll', this.getAll.bind(this));\n        handle('cookies.set', this.set.bind(this));\n        handle('cookies.remove', this.remove.bind(this));\n        handle(\n            'cookies.getAllCookieStores',\n            this.getAllCookieStores.bind(this)\n        );\n\n        this.cookies.addListener('changed', this.onChanged);\n    }\n\n    private async get(\n        event: ExtensionEvent,\n        details: chrome.cookies.Details\n    ): Promise<chrome.cookies.Cookie | null> {\n        // TODO: storeId\n        const cookies = await this.cookies.get({\n            url: details.url,\n            name: details.name,\n        });\n\n        // TODO: If more than one cookie of the same name exists for the given URL,\n        // the one with the longest path will be returned. For cookies with the\n        // same path length, the cookie with the earliest creation time will be returned.\n        return cookies.length > 0 ? createCookieDetails(cookies[0]) : null;\n    }\n\n    private async getAll(\n        event: ExtensionEvent,\n        details: chrome.cookies.GetAllDetails\n    ): Promise<chrome.cookies.Cookie[]> {\n        // TODO: storeId\n        const cookies = await this.cookies.get({\n            url: details.url,\n            name: details.name,\n            domain: details.domain,\n            path: details.path,\n            secure: details.secure,\n            session: details.session,\n        });\n\n        return cookies.map(createCookieDetails);\n    }\n\n    private async set(\n        event: ExtensionEvent,\n        details: chrome.cookies.SetDetails\n    ): Promise<chrome.cookies.Cookie | null> {\n        await this.cookies.set(details);\n        const cookies = await this.cookies.get(details);\n        return cookies.length > 0 ? createCookieDetails(cookies[0]) : null;\n    }\n\n    private async remove(\n        event: ExtensionEvent,\n        details: chrome.cookies.Details\n    ): Promise<chrome.cookies.Details | null> {\n        try {\n            await this.cookies.remove(details.url, details.name);\n        } catch {\n            return null;\n        }\n        return details;\n    }\n\n    private async getAllCookieStores(\n        event: ExtensionEvent\n    ): Promise<chrome.cookies.CookieStore[]> {\n        const tabIds = Array.from(this.ctx.store.tabs)\n            .map((tab) => (tab.isDestroyed() ? undefined : tab.id))\n            .filter(Boolean) as number[];\n        return [{ id: CookieStoreID.Default, tabIds }];\n    }\n\n    private onChanged = (\n        event: {\n            preventDefault: () => void;\n            readonly defaultPrevented: boolean;\n        },\n        cookie: Electron.Cookie,\n        cause: string,\n        removed: boolean\n    ) => {\n        const changeInfo: chrome.cookies.CookieChangeInfo = {\n            cause: onChangedCauseTranslation[cause] || cause,\n            cookie: createCookieDetails(cookie),\n            removed,\n        };\n\n        this.ctx.router.broadcastEvent('cookies.onChanged', changeInfo);\n    };\n}\n","import { app, Extension, Notification } from 'electron'\nimport { ExtensionContext } from '../context'\nimport { ExtensionEvent } from '../router'\nimport { validateExtensionResource } from './common'\n\nenum TemplateType {\n  Basic = 'basic',\n  Image = 'image',\n  List = 'list',\n  Progress = 'progress',\n}\n\nconst getBody = (opts: chrome.notifications.NotificationOptions) => {\n  const { type = TemplateType.Basic } = opts\n\n  switch (type) {\n    case TemplateType.List: {\n      if (!Array.isArray(opts.items)) {\n        throw new Error('List items must be provided for list type')\n      }\n      return opts.items.map((item) => `${item.title} - ${item.message}`).join('\\n')\n    }\n    default:\n      return opts.message || ''\n  }\n}\n\nconst getUrgency = (\n  priority?: number\n): Required<Electron.NotificationConstructorOptions>['urgency'] => {\n  if (typeof priority !== 'number') {\n    return 'normal'\n  } else if (priority >= 2) {\n    return 'critical'\n  } else if (priority < 0) {\n    return 'low'\n  } else {\n    return 'normal'\n  }\n}\n\nconst createScopedIdentifier = (extension: Extension, id: string) => `${extension.id}-${id}`\nconst stripScopeFromIdentifier = (id: string) => {\n  const index = id.indexOf('-')\n  return id.substr(index + 1)\n}\n\nexport class NotificationsAPI {\n  private registry = new Map<string, Notification>()\n\n  constructor(private ctx: ExtensionContext) {\n    const handle = this.ctx.router.apiHandler()\n    handle('notifications.clear', this.clear)\n    handle('notifications.create', this.create)\n    handle('notifications.getAll', this.getAll)\n    handle('notifications.getPermissionLevel', this.getPermissionLevel)\n    handle('notifications.update', this.update)\n\n    this.ctx.session.on('extension-unloaded', (event, extension) => {\n      for (const [key, notification] of this.registry) {\n        if (key.startsWith(extension.id)) {\n          notification.close()\n        }\n      }\n    })\n  }\n\n  private clear = ({ extension }: ExtensionEvent, id: string) => {\n    const notificationId = createScopedIdentifier(extension, id)\n    if (this.registry.has(notificationId)) {\n      this.registry.get(notificationId)?.close()\n    }\n  }\n\n  private create = async ({ extension }: ExtensionEvent, arg1: unknown, arg2?: unknown) => {\n    let id: string\n    let opts: chrome.notifications.NotificationOptions\n\n    if (typeof arg1 === 'object') {\n      id = 'guid' // TODO: generate uuid\n      opts = arg1 as chrome.notifications.NotificationOptions\n    } else if (typeof arg1 === 'string') {\n      id = arg1\n      opts = arg2 as chrome.notifications.NotificationOptions\n    } else {\n      throw new Error('Invalid arguments')\n    }\n\n    if (typeof opts !== 'object' || !opts.type || !opts.iconUrl || !opts.title || !opts.message) {\n      throw new Error('Missing required notification options')\n    }\n\n    const notificationId = createScopedIdentifier(extension, id)\n\n    if (this.registry.has(notificationId)) {\n      this.registry.get(notificationId)?.close()\n    }\n\n    let icon\n\n    if (opts.iconUrl) {\n      let url\n      try {\n        url = new URL(opts.iconUrl)\n      } catch {}\n\n      if (url?.protocol === 'data:') {\n        icon = opts.iconUrl\n      } else {\n        icon = await validateExtensionResource(extension, opts.iconUrl)\n      }\n\n      if (!icon) {\n        throw new Error('Invalid iconUrl')\n      }\n    }\n\n    // TODO: buttons, template types\n\n    const notification = new Notification({\n      title: opts.title,\n      subtitle: app.name,\n      body: getBody(opts),\n      silent: opts.silent,\n      icon,\n      urgency: getUrgency(opts.priority),\n      timeoutType: opts.requireInteraction ? 'never' : 'default',\n    })\n\n    this.registry.set(notificationId, notification)\n\n    notification.on('click', () => {\n      this.ctx.router.sendEvent(extension.id, 'notifications.onClicked', id)\n    })\n\n    notification.once('close', () => {\n      const byUser = true // TODO\n      this.ctx.router.sendEvent(extension.id, 'notifications.onClosed', id, byUser)\n      this.registry.delete(notificationId)\n    })\n\n    notification.show()\n\n    return id\n  }\n\n  private getAll = ({ extension }: ExtensionEvent) => {\n    return Array.from(this.registry.keys())\n      .filter((key) => key.startsWith(extension.id))\n      .map(stripScopeFromIdentifier)\n  }\n\n  private getPermissionLevel = (event: ExtensionEvent) => {\n    return Notification.isSupported() ? 'granted' : 'denied'\n  }\n\n  private update = (\n    { extension }: ExtensionEvent,\n    id: string,\n    opts: chrome.notifications.NotificationOptions\n  ) => {\n    const notificationId = createScopedIdentifier(extension, id)\n\n    const notification = this.registry.get(notificationId)\n\n    if (!notification) {\n      return false\n    }\n\n    // TODO: remaining opts\n\n    if (opts.priority) notification.urgency = getUrgency(opts.priority)\n    if (opts.silent) notification.silent = opts.silent\n  }\n}\n","import { EventEmitter } from 'events'\nimport { ExtensionContext } from '../context'\nimport { ExtensionEvent } from '../router'\nimport { getExtensionManifest } from './common'\n\nexport class RuntimeAPI extends EventEmitter {\n  constructor(private ctx: ExtensionContext) {\n    super()\n\n    const handle = this.ctx.router.apiHandler()\n    handle('runtime.openOptionsPage', this.openOptionsPage)\n  }\n\n  private openOptionsPage = async (event: ExtensionEvent) => {\n    // TODO: options page shouldn't appear in Tabs API\n    // https://developer.chrome.com/extensions/options#tabs-api\n\n    const extension = event.extension;\n    const manifest = getExtensionManifest(extension)\n\n    if (manifest.options_ui) {\n      // Embedded option not support (!options_ui.open_in_new_tab)\n      const url = `chrome-extension://${extension.id}/${manifest.options_ui.page}`\n      await this.ctx.store.createTab({ url, active: true }, event)\n    } else if (manifest.options_page) {\n      const url = `chrome-extension://${extension.id}/${manifest.options_page}`\n      await this.ctx.store.createTab({ url, active: true }, event)\n    }\n  }\n}\n","import path from 'node:path';\nimport { parse } from 'node:url';\nimport { BrowserWindow } from 'electron';\nimport { ExtensionContext } from '../context';\nimport { ExtensionEvent } from '../router';\nimport { ensureSuffix } from '../utils';\nimport { TabContents } from './common';\nimport { WindowsAPI } from './windows';\n\nconst debug = require('debug')('electron-chrome-extensions:tabs');\n\nexport class TabsAPI {\n    static TAB_ID_NONE = -1;\n    static WINDOW_ID_NONE = -1;\n    static WINDOW_ID_CURRENT = -2;\n\n    constructor(private ctx: ExtensionContext) {\n        const handle = this.ctx.router.apiHandler();\n        handle('tabs.get', this.get.bind(this));\n        handle('tabs.getAllInWindow', this.getAllInWindow.bind(this));\n        handle('tabs.getCurrent', this.getCurrent.bind(this));\n        handle('tabs.create', this.create.bind(this));\n        handle('tabs.insertCSS', this.insertCSS.bind(this));\n        handle('tabs.query', this.query.bind(this));\n        handle('tabs.reload', this.reload.bind(this));\n        handle('tabs.update', this.update.bind(this));\n        handle('tabs.remove', this.remove.bind(this));\n        handle('tabs.goForward', this.goForward.bind(this));\n        handle('tabs.goBack', this.goBack.bind(this));\n\n        this.ctx.store.on('tab-added', this.observeTab.bind(this));\n    }\n\n    private observeTab(tab: TabContents) {\n        const tabId = tab.id;\n\n        const updateEvents = [\n            'page-title-updated', // title\n            'did-start-loading', // status\n            'did-stop-loading', // status\n            'media-started-playing', // audible\n            'media-paused', // audible\n            'did-start-navigation', // url\n            'did-redirect-navigation', // url\n            'did-navigate-in-page', // url\n        ];\n\n        const updateHandler = () => {\n            this.onUpdated(tabId);\n        };\n\n        updateEvents.forEach((eventName) => {\n            tab.on(eventName as any, updateHandler);\n        });\n\n        const faviconHandler = (event: Electron.Event, favicons: string[]) => {\n            (tab as TabContents).favicon = favicons[0];\n            this.onUpdated(tabId);\n        };\n        tab.on('page-favicon-updated', faviconHandler);\n\n        tab.once('destroyed', () => {\n            updateEvents.forEach((eventName) => {\n                tab.off(eventName as any, updateHandler);\n            });\n            tab.off('page-favicon-updated', faviconHandler);\n\n            this.ctx.store.removeTab(tab);\n            this.onRemoved(tabId);\n        });\n\n        this.onCreated(tabId);\n        this.onActivated(tabId);\n\n        debug(`Observing tab[${tabId}][${tab.getType()}] ${tab.getURL()}`);\n    }\n\n    private createTabDetails(tab: TabContents) {\n        const tabId = tab.id;\n        const activeTab = this.ctx.store.getActiveTabFromWebContents(tab);\n        let win = this.ctx.store.tabToWindow.get(tab);\n        if (win?.isDestroyed()) win = undefined;\n        const [width = 0, height = 0] = win ? win.getSize() : [];\n\n        const details: chrome.tabs.Tab = {\n            active: activeTab?.id === tabId,\n            audible: tab.isCurrentlyAudible(),\n            autoDiscardable: true,\n            discarded: false,\n            favIconUrl: tab.favicon || undefined,\n            height,\n            highlighted: false,\n            id: tabId,\n            incognito: false,\n            index: -1, // TODO\n            mutedInfo: { muted: tab.audioMuted },\n            pinned: false,\n            selected: true,\n            status: tab.isLoading() ? 'loading' : 'complete',\n            title: tab.getTitle(),\n            url: tab.getURL(), // TODO: tab.mainFrame.url (Electron 12)\n            width,\n            windowId: win ? win.id : -1,\n        };\n\n        if (typeof this.ctx.store.impl.assignTabDetails === 'function') {\n            this.ctx.store.impl.assignTabDetails(details, tab);\n        }\n\n        this.ctx.store.tabDetailsCache.set(tab.id, details);\n        return details;\n    }\n\n    private getTabDetails(tab: TabContents) {\n        if (this.ctx.store.tabDetailsCache.has(tab.id)) {\n            return this.ctx.store.tabDetailsCache.get(tab.id);\n        }\n        const details = this.createTabDetails(tab);\n        return details;\n    }\n\n    private get(event: ExtensionEvent, tabId: number) {\n        const tab = this.ctx.store.getTabById(tabId);\n        if (!tab) return { id: TabsAPI.TAB_ID_NONE };\n        return this.getTabDetails(tab);\n    }\n\n    private getAllInWindow(\n        event: ExtensionEvent,\n        windowId: number = TabsAPI.WINDOW_ID_CURRENT\n    ) {\n        if (windowId === TabsAPI.WINDOW_ID_CURRENT)\n            windowId = this.ctx.store.lastFocusedWindowId!;\n\n        const tabs = Array.from(this.ctx.store.tabs).filter((tab) => {\n            if (tab.isDestroyed()) return false;\n\n            const browserWindow = this.ctx.store.tabToWindow.get(tab);\n            if (!browserWindow || browserWindow.isDestroyed()) return;\n\n            return browserWindow.id === windowId;\n        });\n\n        return tabs.map(this.getTabDetails.bind(this));\n    }\n\n    private getCurrent(event: ExtensionEvent) {\n        const tab = this.ctx.store.getActiveTabFromWebContents(event.sender);\n        return tab ? this.getTabDetails(tab) : undefined;\n    }\n\n    private async create(\n        event: ExtensionEvent,\n        details: chrome.tabs.CreateProperties = {}\n    ) {\n        let url = details.url;\n\n        // TODO: add test for this process\n        if (url && event.extension) {\n            const urlInfo = parse(url || '');\n            const baseURL = ensureSuffix(event.extension.url, '/');\n\n            if (!urlInfo.protocol && !urlInfo.hostname) {\n                url = path.posix.join(baseURL, url);\n            } else if (!urlInfo.hostname) {\n                url = path.posix.join(baseURL, url);\n            }\n        }\n\n        const tab = await this.ctx.store.createTab({ ...details, url }, event);\n        if (!tab) return;\n\n        const tabDetails = this.getTabDetails(tab);\n        if (details.active) {\n            queueMicrotask(() => this.onActivated(tab.id));\n        }\n        return tabDetails;\n    }\n\n    private insertCSS(\n        event: ExtensionEvent,\n        tabId: number,\n        details: chrome.tabs.InjectDetails\n    ) {\n        const tab = this.ctx.store.getTabById(tabId);\n        if (!tab) return;\n\n        // TODO: move to webFrame in renderer?\n        if (details.code) {\n            tab.insertCSS(details.code);\n        }\n    }\n\n    private async query(\n        event: ExtensionEvent,\n        info: chrome.tabs.QueryInfo = {}\n    ) {\n        const isSet = (value: any) => typeof value !== 'undefined';\n\n        const lastFocusedWindow = this.ctx.store.getLastFocusedWindow() || null;\n        const currentWin = await this.ctx.store.windowsGetCurrent(event);\n\n        // received 'tabs.query' [ { active: true, currentWindow: true } ]\n        // won't return any tabs if called from the extension popup, because of the currentWindow flag.\n        // In that case, the popup is the current window (which is correct), but this has no tabs.\n        // So extensions can never see dApps from their popups.\n        // From looking at the docs, this looks like correct behaviour but it mysteriously finds the tabs in Chrome.\n        // So we need a workaround here where filtering by current window will also check last focused.\n\n        const filteredTabs = Array.from(this.ctx.store.tabs)\n            .map(this.getTabDetails.bind(this))\n            .filter((tab) => {\n                if (!tab) return false;\n                if (isSet(info.active) && info.active !== tab.active)\n                    return false;\n                if (isSet(info.pinned) && info.pinned !== tab.pinned)\n                    return false;\n                if (isSet(info.audible) && info.audible !== tab.audible)\n                    return false;\n                if (isSet(info.muted) && info.muted !== tab.mutedInfo?.muted)\n                    return false;\n                if (\n                    isSet(info.highlighted) &&\n                    info.highlighted !== tab.highlighted\n                )\n                    return false;\n                if (isSet(info.discarded) && info.discarded !== tab.discarded)\n                    return false;\n                if (\n                    isSet(info.autoDiscardable) &&\n                    info.autoDiscardable !== tab.autoDiscardable\n                )\n                    return false;\n\n                if (isSet(info.currentWindow)) {\n                    if (info.currentWindow && !currentWin) return false;\n                    if (info.currentWindow && currentWin?.id !== tab.windowId) {\n                        // The workaround\n                        if (lastFocusedWindow?.id === tab.windowId) {\n                            return true;\n                        }\n                        return false;\n                    }\n                }\n\n                if (isSet(info.lastFocusedWindow)) {\n                    if (info.lastFocusedWindow && !lastFocusedWindow)\n                        return false;\n                    if (\n                        info.lastFocusedWindow &&\n                        lastFocusedWindow?.id !== tab.windowId\n                    )\n                        return false;\n                }\n\n                if (isSet(info.status) && info.status !== tab.status)\n                    return false;\n                if (isSet(info.title) && info.title !== tab.title) return false; // TODO: pattern match\n                if (isSet(info.url) && info.url !== tab.url) return false; // TODO: match URL pattern\n                if (isSet(info.windowId)) {\n                    if (info.windowId === TabsAPI.WINDOW_ID_CURRENT) {\n                        if (!currentWin || currentWin?.id !== tab.windowId)\n                            return false;\n                    } else if (info.windowId !== tab.windowId) {\n                        return false;\n                    }\n                }\n                // if (isSet(info.windowType) && info.windowType !== tab.windowType) return false\n                // if (isSet(info.index) && info.index !== tab.index) return false\n                return true;\n            })\n            .map((tab, index) => {\n                if (tab) {\n                    tab.index = index;\n                }\n                return tab;\n            });\n        return filteredTabs;\n    }\n\n    private reload(event: ExtensionEvent, arg1?: unknown, arg2?: unknown) {\n        const tabId: number | undefined =\n            typeof arg1 === 'number' ? arg1 : undefined;\n        const reloadProperties: chrome.tabs.ReloadProperties | null =\n            typeof arg1 === 'object'\n                ? arg1\n                : typeof arg2 === 'object'\n                ? arg2\n                : {};\n\n        const tab = tabId\n            ? this.ctx.store.getTabById(tabId)\n            : this.ctx.store.getActiveTabFromWebContents(event.sender);\n\n        if (!tab) return;\n\n        if (reloadProperties?.bypassCache) {\n            tab.reloadIgnoringCache();\n        } else {\n            tab.reload();\n        }\n    }\n\n    private async update(\n        event: ExtensionEvent,\n        arg1?: unknown,\n        arg2?: unknown\n    ) {\n        let tabId = typeof arg1 === 'number' ? arg1 : undefined;\n        const updateProperties: chrome.tabs.UpdateProperties =\n            (typeof arg1 === 'object' ? (arg1 as any) : (arg2 as any)) || {};\n\n        const tab = tabId\n            ? this.ctx.store.getTabById(tabId)\n            : this.ctx.store.getActiveTabFromWebContents(event.sender);\n        if (!tab) return;\n\n        tabId = tab.id;\n\n        const props = updateProperties;\n\n        // TODO: validate URL, prevent 'javascript:'\n        if (props.url) await tab.loadURL(props.url);\n\n        if (typeof props.muted === 'boolean') tab.setAudioMuted(props.muted);\n\n        if (props.active) this.onActivated(tabId);\n\n        this.onUpdated(tabId);\n\n        return this.createTabDetails(tab);\n    }\n\n    private remove(event: ExtensionEvent, id: number | number[]) {\n        const ids = Array.isArray(id) ? id : [id];\n\n        ids.forEach((tabId) => {\n            const tab = this.ctx.store.getTabById(tabId);\n            if (tab) this.ctx.store.removeTab(tab);\n            this.onRemoved(tabId);\n        });\n    }\n\n    private goForward(event: ExtensionEvent, arg1?: unknown) {\n        const tabId = typeof arg1 === 'number' ? arg1 : undefined;\n        const tab = tabId\n            ? this.ctx.store.getTabById(tabId)\n            : this.ctx.store.getActiveTabFromWebContents(event.sender);\n        if (!tab) return;\n        tab.goForward();\n    }\n\n    private goBack(event: ExtensionEvent, arg1?: unknown) {\n        const tabId = typeof arg1 === 'number' ? arg1 : undefined;\n        const tab = tabId\n            ? this.ctx.store.getTabById(tabId)\n            : this.ctx.store.getActiveTabFromWebContents(event.sender);\n        if (!tab) return;\n        tab.goBack();\n    }\n\n    onCreated(tabId: number) {\n        const tab = this.ctx.store.getTabById(tabId);\n        if (!tab) return;\n        const tabDetails = this.getTabDetails(tab);\n        this.ctx.router.broadcastEvent('tabs.onCreated', tabDetails);\n    }\n\n    onUpdated(tabId: number) {\n        const tab = this.ctx.store.getTabById(tabId);\n        if (!tab) return;\n\n        let prevDetails;\n        if (this.ctx.store.tabDetailsCache.has(tab.id)) {\n            prevDetails = this.ctx.store.tabDetailsCache.get(tab.id);\n        }\n        if (!prevDetails) return;\n\n        const details = this.createTabDetails(tab);\n\n        const compareProps: (keyof chrome.tabs.Tab)[] = [\n            'status',\n            'url',\n            'pinned',\n            'audible',\n            'discarded',\n            'autoDiscardable',\n            'mutedInfo',\n            'favIconUrl',\n            'title',\n        ];\n\n        let didUpdate = false;\n        const changeInfo: chrome.tabs.TabChangeInfo = {};\n\n        for (const prop of compareProps) {\n            if (details[prop] !== prevDetails[prop]) {\n                (changeInfo as any)[prop] = details[prop];\n                didUpdate = true;\n            }\n        }\n\n        if (!didUpdate) return;\n\n        this.ctx.router.broadcastEvent(\n            'tabs.onUpdated',\n            tab.id,\n            changeInfo,\n            details\n        );\n    }\n\n    onRemoved(tabId: number) {\n        const details = this.ctx.store.tabDetailsCache.has(tabId)\n            ? this.ctx.store.tabDetailsCache.get(tabId)\n            : null;\n        this.ctx.store.tabDetailsCache.delete(tabId);\n\n        const windowId = details ? details.windowId : WindowsAPI.WINDOW_ID_NONE;\n        const win =\n            typeof windowId !== 'undefined' && windowId > -1\n                ? BrowserWindow.getAllWindows().find(\n                      (win) => win.id === windowId\n                  )\n                : null;\n\n        this.ctx.router.broadcastEvent('tabs.onRemoved', tabId, {\n            windowId,\n            isWindowClosing: win ? win.isDestroyed() : false,\n        });\n    }\n\n    onActivated(tabId: number) {\n        const tab = this.ctx.store.getTabById(tabId);\n        if (!tab) return;\n\n        const activeTab = this.ctx.store.getActiveTabFromWebContents(tab);\n        const activeChanged = activeTab?.id !== tabId;\n        if (!activeChanged) return;\n\n        const win = this.ctx.store.tabToWindow.get(tab);\n\n        this.ctx.store.setActiveTab(tab);\n\n        // invalidate cache since 'active' has changed\n        this.ctx.store.tabDetailsCache.forEach((tabInfo, cacheTabId) => {\n            tabInfo.active = tabId === cacheTabId;\n        });\n\n        this.ctx.router.broadcastEvent('tabs.onActivated', {\n            tabId,\n            windowId: win?.id,\n        });\n    }\n}\n","import * as electron from 'electron';\nimport { ExtensionContext } from '../context';\nimport { ExtensionEvent } from '../router';\n\nconst debug = require('debug')('electron-chrome-extensions:webNavigation');\n\n// https://github.com/electron/electron/pull/25464\nconst getFrame = (frameProcessId: number, frameRoutingId: number) => {\n    return (\n        ('webFrameMain' in electron &&\n            (electron as any).webFrameMain.fromId(\n                frameProcessId,\n                frameRoutingId\n            )) ||\n        null\n    );\n};\n\nconst getFrameId = (frame: any) =>\n    'webFrameMain' in electron\n        ? frame === frame.top\n            ? 0\n            : frame.frameTreeNodeId\n        : -1;\n\nconst getParentFrameId = (frame: any) => {\n    const parentFrame = frame?.parent;\n    return parentFrame ? getFrameId(parentFrame) : -1;\n};\n\nconst getFrameDetails = (frame: any) => ({\n    errorOccurred: false, // TODO\n    processId: frame.processId,\n    frameId: getFrameId(frame),\n    parentFrameId: getParentFrameId(frame),\n    url: frame.url,\n});\n\nexport class WebNavigationAPI {\n    constructor(private ctx: ExtensionContext) {\n        const handle = this.ctx.router.apiHandler();\n        handle('webNavigation.getFrame', this.getFrame.bind(this));\n        handle('webNavigation.getAllFrames', this.getAllFrames.bind(this));\n\n        this.ctx.store.on('tab-added', this.observeTab.bind(this));\n    }\n\n    private observeTab(tab: Electron.WebContents) {\n        tab.once('will-navigate', this.onCreatedNavigationTarget as any);\n        tab.on('did-start-navigation', this.onBeforeNavigate as any);\n        tab.on('did-frame-finish-load', this.onFinishLoad as any);\n        tab.on('did-frame-navigate', this.onCommitted as any);\n        tab.on('did-navigate-in-page', this.onHistoryStateUpdated as any);\n\n        tab.on('frame-created', (e, { frame }) => {\n            if (frame.top === frame) return;\n\n            frame.on('dom-ready', () => {\n                this.onDOMContentLoaded(tab, frame);\n            });\n        });\n\n        // Main frame dom-ready event\n        tab.on('dom-ready', () => {\n            if ('mainFrame' in tab) {\n                this.onDOMContentLoaded(tab, tab.mainFrame);\n            }\n        });\n    }\n\n    private getFrame(\n        event: ExtensionEvent,\n        details: chrome.webNavigation.GetFrameDetails\n    ): chrome.webNavigation.GetFrameResultDetails | null {\n        const tab = this.ctx.store.getTabById(details.tabId);\n        if (!tab) return null;\n\n        let targetFrame: any;\n\n        if (typeof details.frameId === 'number') {\n            // https://github.com/electron/electron/pull/25464\n            if ('mainFrame' in tab) {\n                const mainFrame = (tab as any).mainFrame;\n                targetFrame = mainFrame.framesInSubtree.find((frame: any) => {\n                    const isMainFrame = frame === frame.top;\n                    return isMainFrame\n                        ? details.frameId === 0\n                        : details.frameId === frame.frameTreeNodeId;\n                });\n            }\n        }\n\n        return targetFrame ? getFrameDetails(targetFrame) : null;\n    }\n\n    private getAllFrames(\n        event: ExtensionEvent,\n        details: chrome.webNavigation.GetFrameDetails\n    ): chrome.webNavigation.GetAllFrameResultDetails[] | null {\n        const tab = this.ctx.store.getTabById(details.tabId);\n        if (!tab || !('mainFrame' in tab)) return [];\n        return (tab as any).mainFrame.framesInSubtree.map(getFrameDetails);\n    }\n\n    private sendNavigationEvent = (\n        eventName: string,\n        details: { url: string }\n    ) => {\n        debug(`${eventName} [url: ${details.url}]`);\n        this.ctx.router.broadcastEvent(`webNavigation.${eventName}`, details);\n    };\n\n    private onCreatedNavigationTarget = (\n        event: Electron.IpcMainEvent,\n        url: string,\n        isInPlace: boolean,\n        isMainFrame: boolean,\n        frameProcessId: number,\n        frameRoutingId: number\n    ) => {\n        const frame = getFrame(frameProcessId, frameRoutingId);\n        const tab = event.sender;\n        const details: chrome.webNavigation.WebNavigationSourceCallbackDetails =\n            {\n                sourceTabId: tab?.id,\n                sourceProcessId: frameProcessId,\n                sourceFrameId: getFrameId(frame),\n                url,\n                tabId: tab?.id,\n                timeStamp: Date.now(),\n            };\n        this.sendNavigationEvent('onCreatedNavigationTarget', details);\n    };\n\n    private onBeforeNavigate = (\n        event: Electron.IpcMainEvent,\n        url: string,\n        isInPlace: number,\n        isMainFrame: boolean,\n        frameProcessId: number,\n        frameRoutingId: number\n    ) => {\n        if (isInPlace) return;\n\n        const frame = getFrame(frameProcessId, frameRoutingId);\n        const tab = event.sender;\n        const details: chrome.webNavigation.WebNavigationParentedCallbackDetails =\n            {\n                frameId: getFrameId(frame),\n                parentFrameId: getParentFrameId(frame),\n                processId: frameProcessId,\n                tabId: tab?.id,\n                timeStamp: Date.now(),\n                url,\n            };\n\n        this.sendNavigationEvent('onBeforeNavigate', details);\n    };\n\n    private onCommitted = (\n        event: Electron.IpcMainEvent,\n        url: string,\n        httpResponseCode: number,\n        httpStatusText: string,\n        isMainFrame: boolean,\n        frameProcessId: number,\n        frameRoutingId: number\n    ) => {\n        const frame = getFrame(frameProcessId, frameRoutingId);\n        const tab = event.sender;\n        const details: chrome.webNavigation.WebNavigationParentedCallbackDetails =\n            {\n                frameId: getFrameId(frame),\n                parentFrameId: getParentFrameId(frame),\n                processId: frameProcessId,\n                tabId: tab?.id,\n                timeStamp: Date.now(),\n                url,\n            };\n        this.sendNavigationEvent('onCommitted', details);\n    };\n\n    private onHistoryStateUpdated = (\n        event: Electron.IpcMainEvent,\n        url: string,\n        isMainFrame: boolean,\n        frameProcessId: number,\n        frameRoutingId: number\n    ) => {\n        const frame = getFrame(frameProcessId, frameRoutingId);\n        const tab = event.sender;\n        const details: chrome.webNavigation.WebNavigationTransitionCallbackDetails & {\n            parentFrameId: number;\n        } = {\n            transitionType: '', // TODO\n            transitionQualifiers: [], // TODO\n            frameId: getFrameId(frame),\n            parentFrameId: getParentFrameId(frame),\n            processId: frameProcessId,\n            tabId: tab?.id,\n            timeStamp: Date.now(),\n            url,\n        };\n        this.sendNavigationEvent('onHistoryStateUpdated', details);\n    };\n\n    private onDOMContentLoaded = (\n        tab: Electron.WebContents,\n        frame: Electron.WebFrameMain\n    ) => {\n        const details: chrome.webNavigation.WebNavigationParentedCallbackDetails =\n            {\n                frameId: getFrameId(frame),\n                parentFrameId: getParentFrameId(frame),\n                processId: frame.processId,\n                tabId: tab?.id,\n                timeStamp: Date.now(),\n                url: frame.url,\n            };\n        this.sendNavigationEvent('onDOMContentLoaded', details);\n\n        if (!tab.isLoadingMainFrame()) {\n            this.sendNavigationEvent('onCompleted', details);\n        }\n    };\n\n    private onFinishLoad = (\n        event: Electron.IpcMainEvent,\n        isMainFrame: boolean,\n        frameProcessId: number,\n        frameRoutingId: number\n    ) => {\n        const frame = getFrame(frameProcessId, frameRoutingId);\n        const tab = event.sender;\n        const url = tab?.getURL();\n        const details: chrome.webNavigation.WebNavigationParentedCallbackDetails =\n            {\n                frameId: getFrameId(frame),\n                parentFrameId: getParentFrameId(frame),\n                processId: frameProcessId,\n                tabId: tab?.id,\n                timeStamp: Date.now(),\n                url,\n            };\n        this.sendNavigationEvent('onCompleted', details);\n    };\n}\n","import path from 'node:path';\nimport { parse } from 'node:url';\nimport { BrowserWindow } from 'electron';\nimport { ExtensionContext } from '../context';\nimport { ExtensionEvent } from '../router';\nimport { ensureSuffix, unPrefix } from '../utils';\n\nconst debug = require('debug')('electron-chrome-extensions:windows');\n\nconst getWindowState = (win: BrowserWindow): chrome.windows.Window['state'] => {\n    if (win.isMaximized()) return 'maximized';\n    if (win.isMinimized()) return 'minimized';\n    if (win.isFullScreen()) return 'fullscreen';\n    return 'normal';\n};\n\nexport class WindowsAPI {\n    static WINDOW_ID_NONE = -1;\n    static WINDOW_ID_CURRENT = -2;\n\n    constructor(private ctx: ExtensionContext) {\n        const handle = this.ctx.router.apiHandler();\n        handle('windows.get', this.get.bind(this));\n        handle('windows.getCurrent', this.getCurrent.bind(this));\n        handle('windows.getLastFocused', this.getLastFocused.bind(this));\n        handle('windows.getAll', this.getAll.bind(this));\n        handle('windows.create', this.create.bind(this));\n        handle('windows.update', this.update.bind(this));\n        handle('windows.remove', this.remove.bind(this));\n\n        this.ctx.store.on('window-added', this.observeWindow.bind(this));\n    }\n\n    private observeWindow(window: Electron.BrowserWindow) {\n        if (!window || window.isDestroyed()) {\n            debug('observeWindow: window is destroyed');\n            return;\n        }\n\n        const windowId = window.id;\n\n        const onFocus = () => {\n            this.onFocusChanged(windowId);\n        };\n\n        const onClosed = () => {\n            this.ctx.store.windowDetailsCache.delete(windowId);\n            this.ctx.store.removeWindow(window);\n            this.onRemoved(windowId);\n        };\n\n        const onRestoreOrMove = () => {\n            const details = this.getWindowDetails(window);\n            details.state = 'normal';\n            this.ctx.store.windowDetailsCache.set(windowId, details);\n        };\n\n        const onMinimize = () => {\n            const details = this.getWindowDetails(window);\n            details.state = 'minimized';\n            this.ctx.store.windowDetailsCache.set(windowId, details);\n        };\n\n        const onMaximize = () => {\n            const details = this.getWindowDetails(window);\n            details.state = 'maximized';\n            this.ctx.store.windowDetailsCache.set(windowId, details);\n        };\n\n        const onEnterFullscreen = () => {\n            const details = this.getWindowDetails(window);\n            details.state = 'fullscreen';\n            this.ctx.store.windowDetailsCache.set(windowId, details);\n        };\n\n        const onLeaveFullscreen = () => {\n            const details = this.getWindowDetails(window);\n            details.state = getWindowState(window);\n            this.ctx.store.windowDetailsCache.set(windowId, details);\n        };\n\n        window.on('focus', onFocus);\n        window.once('closed', onClosed);\n        window.on('restore', onRestoreOrMove);\n        if (process.platform === 'win32') {\n            window.on('moved', onRestoreOrMove);\n        }\n        window.on('minimize', onMinimize);\n        window.on('maximize', onMaximize);\n        window.on('enter-full-screen', onEnterFullscreen);\n        window.on('enter-html-full-screen', onEnterFullscreen);\n        window.on('leave-full-screen', onLeaveFullscreen);\n        window.on('leave-html-full-screen', onLeaveFullscreen);\n\n        this.onCreated(windowId);\n\n        debug(`Observing window[${windowId}]`);\n    }\n\n    private createWindowDetails(win: BrowserWindow) {\n        const details: Partial<chrome.windows.Window> = {\n            id: win.id,\n            focused: win.isFocused(),\n            top: win.getPosition()[1],\n            left: win.getPosition()[0],\n            width: win.getSize()[0],\n            height: win.getSize()[1],\n            tabs: Array.from(this.ctx.store.tabs)\n                .filter((tab) => {\n                    const ownerWindow = this.ctx.store.tabToWindow.get(tab);\n                    return ownerWindow?.isDestroyed()\n                        ? false\n                        : ownerWindow?.id === win.id;\n                })\n                .map(\n                    (tab) =>\n                        this.ctx.store.tabDetailsCache.get(\n                            tab.id\n                        ) as chrome.tabs.Tab\n                )\n                .filter(Boolean),\n            incognito: !win.webContents.session.isPersistent(),\n            type: 'normal', // TODO\n            state: getWindowState(win),\n            alwaysOnTop: win.isAlwaysOnTop(),\n            sessionId: 'default', // TODO\n        };\n\n        this.ctx.store.windowDetailsCache.set(win.id, details);\n        return details;\n    }\n\n    private getWindowDetails(win: BrowserWindow) {\n        if (this.ctx.store.windowDetailsCache.has(win.id)) {\n            return this.ctx.store.windowDetailsCache.get(win.id)!;\n        }\n        const details = this.createWindowDetails(win);\n        return details;\n    }\n\n    private async getWindowFromId(event: ExtensionEvent, id: number) {\n        if (id === WindowsAPI.WINDOW_ID_CURRENT) {\n            return (\n                (await this.ctx.store.windowsGetCurrent(event)) ||\n                this.ctx.store.getLastFocusedWindow()\n            );\n        } else {\n            return this.ctx.store.getWindowById(event, id);\n        }\n    }\n\n    private async get(event: ExtensionEvent, windowId: number) {\n        let win: Electron.BrowserWindow | null;\n        if (windowId === WindowsAPI.WINDOW_ID_CURRENT) {\n            win =\n                (await this.ctx.store.windowsGetCurrent(event)) ||\n                this.ctx.store.getLastFocusedWindow() ||\n                null;\n        } else {\n            win = (await this.getWindowFromId(event, windowId)) || null;\n        }\n        if (!win) return { id: WindowsAPI.WINDOW_ID_NONE };\n        return this.getWindowDetails(win);\n    }\n\n    private getLastFocused(event: ExtensionEvent) {\n        const win = this.ctx.store.getLastFocusedWindow();\n        return win ? this.getWindowDetails(win) : null;\n    }\n\n    // not same with `getLastFocused`, `getCurrent` means the host window where javascript executing\n    // OR the last focused window if we're calling from a background script (with no window of its own)\n    private async getCurrent(event: ExtensionEvent) {\n        const currentWin = await this.ctx.store.windowsGetCurrent(event);\n        const lastFocusedWin = this.ctx.store.getLastFocusedWindow();\n\n        const win = currentWin || lastFocusedWin;\n\n        return win ? this.getWindowDetails(win) : null;\n    }\n\n    private getAll(event: ExtensionEvent) {\n        return Array.from(this.ctx.store.windows).map(\n            this.getWindowDetails.bind(this)\n        );\n    }\n\n    private async create(\n        event: ExtensionEvent,\n        details: chrome.windows.CreateData\n    ) {\n        const baseURL = ensureSuffix(event.extension.url, '/');\n\n        let url = Array.isArray(details.url)\n            ? details.url[0]\n            : details.url || '';\n\n        const urlInfo = parse(url);\n\n        if (!urlInfo.protocol && !urlInfo.hostname) {\n            url = baseURL + unPrefix(url, ['./', '/']);\n        } else if (!urlInfo.hostname) {\n            url = baseURL + unPrefix(url, ['./', '/']);\n        }\n\n        const win = await this.ctx.store.createWindow(event, {\n            ...details,\n            url,\n        });\n        return this.getWindowDetails(win);\n    }\n\n    private async update(\n        event: ExtensionEvent,\n        windowId: number,\n        updateProperties: chrome.windows.UpdateInfo = {}\n    ) {\n        const win = await this.getWindowFromId(event, windowId);\n        if (!win) return;\n\n        const props = updateProperties;\n\n        if (props.state) {\n            switch (props.state) {\n                case 'maximized':\n                    win.maximize();\n                    break;\n                case 'minimized':\n                    win.minimize();\n                    break;\n                case 'fullscreen':\n                    if (win.fullScreenable) win.setFullScreen(true);\n                    else {\n                        console.warn('window is not fullScreenable');\n                    }\n                    break;\n                case 'normal': {\n                    if (win.isFullScreen()) {\n                        win.setFullScreen(false);\n                    } else if (win.isMinimized() || win.isMaximized()) {\n                        win.restore();\n                    }\n                    break;\n                }\n            }\n        }\n\n        return this.createWindowDetails(win);\n    }\n\n    private async remove(\n        event: ExtensionEvent,\n        windowId: number = WindowsAPI.WINDOW_ID_CURRENT\n    ) {\n        const win = await this.getWindowFromId(event, windowId);\n        if (!win) return;\n        const removedWindowId = win.id;\n        await this.ctx.store.removeWindow(win);\n        this.onRemoved(removedWindowId);\n    }\n\n    onCreated(windowId: number) {\n        const window = this.ctx.store.findWindowById(windowId);\n        if (!window) return;\n        const windowDetails = this.getWindowDetails(window);\n        this.ctx.router.broadcastEvent('windows.onCreated', windowDetails);\n    }\n\n    onRemoved(windowId: number) {\n        this.ctx.router.broadcastEvent('windows.onRemoved', windowId);\n    }\n\n    onFocusChanged(windowId: number) {\n        if (this.ctx.store.lastFocusedWindowId === windowId) return;\n\n        this.ctx.store.lastFocusedWindowId = windowId;\n        this.ctx.router.broadcastEvent('windows.onFocusChanged', windowId);\n    }\n}\n","import { app, session as electronSession } from 'electron'\nimport { EventEmitter } from 'events'\nimport path from 'path'\nimport { promises as fs } from 'fs'\n\nimport { BrowserActionAPI } from './api/browser-action'\nimport { TabsAPI } from './api/tabs'\nimport { WindowsAPI } from './api/windows'\nimport { WebNavigationAPI } from './api/web-navigation'\nimport { ExtensionStore } from './store'\nimport { ContextMenusAPI } from './api/context-menus'\nimport { RuntimeAPI } from './api/runtime'\nimport { CookiesAPI } from './api/cookies'\nimport { NotificationsAPI } from './api/notifications'\nimport { ChromeExtensionImpl } from './impl'\nimport { CommandsAPI } from './api/commands'\nimport { ExtensionContext } from './context'\nimport { ExtensionRouter } from './router'\n\nexport interface ChromeExtensionOptions extends ChromeExtensionImpl {\n  session?: Electron.Session\n\n  /**\n   * Path to electron-chrome-extensions module files. Might be needed if\n   * JavaScript bundlers like Webpack are used in your build process.\n   */\n  modulePath?: string\n  /**\n   * if not provided, default <modulePath>/dist/js\n   */\n  preloadPath?: string\n}\n\nconst sessionMap = new WeakMap<Electron.Session, ElectronChromeExtensions>()\n\n/**\n * Provides an implementation of various Chrome extension APIs to a session.\n */\nexport class ElectronChromeExtensions extends EventEmitter {\n  /** Retrieve an instance of this class associated with the given session. */\n  static fromSession(session: Electron.Session) {\n    return sessionMap.get(session)\n  }\n\n  private ctx: ExtensionContext\n  private modulePath: string\n  private preloadPath: string\n\n  private api: {\n    browserAction: BrowserActionAPI\n    contextMenus: ContextMenusAPI\n    commands: CommandsAPI\n    cookies: CookiesAPI\n    notifications: NotificationsAPI\n    runtime: RuntimeAPI\n    tabs: TabsAPI\n    webNavigation: WebNavigationAPI\n    windows: WindowsAPI\n  }\n\n  constructor(opts?: ChromeExtensionOptions) {\n    super()\n\n    const { session = electronSession.defaultSession, modulePath, preloadPath, ...impl } = opts || {}\n\n    if (sessionMap.has(session)) {\n      throw new Error(`Extensions instance already exists for the given session`)\n    }\n\n    sessionMap.set(session, this)\n\n    const router = new ExtensionRouter(session)\n    const store = new ExtensionStore(impl)\n\n    this.ctx = {\n      emit: this.emit.bind(this),\n      router,\n      session,\n      store,\n    }\n\n    this.modulePath = modulePath || path.join(__dirname, '..');\n    this.preloadPath = preloadPath || '';\n\n    this.api = {\n      browserAction: new BrowserActionAPI(this.ctx),\n      contextMenus: new ContextMenusAPI(this.ctx),\n      commands: new CommandsAPI(this.ctx),\n      cookies: new CookiesAPI(this.ctx),\n      notifications: new NotificationsAPI(this.ctx),\n      runtime: new RuntimeAPI(this.ctx),\n      tabs: new TabsAPI(this.ctx),\n      webNavigation: new WebNavigationAPI(this.ctx),\n      windows: new WindowsAPI(this.ctx),\n    }\n\n    this.prependPreload()\n  }\n\n  private async prependPreload() {\n    const { session } = this.ctx\n    let preloads = session.getPreloads()\n\n    const preloadPath = this.preloadPath || path.join(this.modulePath, 'dist/preload.js');\n\n    const preloadIndex = preloads.indexOf(preloadPath)\n    if (preloadIndex > -1) {\n      preloads.splice(preloadIndex, 1)\n    }\n\n    preloads = [preloadPath, ...preloads]\n    session.setPreloads(preloads)\n\n    let preloadExists = false\n    try {\n      const stat = await fs.stat(preloadPath)\n      preloadExists = stat.isFile()\n    } catch {}\n\n    if (!preloadExists) {\n      console.error(\n        `Unable to access electron-chrome-extensions preload file (${preloadPath}). Consider configuring the 'modulePath' constructor option.`\n      )\n    }\n  }\n\n  /** Add webContents to be tracked as a tab. */\n  addTab(tab: Electron.WebContents, window: Electron.BrowserWindow) {\n    this.ctx.store.addTab(tab, window)\n  }\n\n  /** Add window created outside/before extensions initialized */\n  addWindow(window: Electron.BrowserWindow) {\n    this.ctx.store.addWindow(window)\n  }\n\n  /** Notify extension system that the active tab has changed. */\n  selectTab(tab: Electron.WebContents) {\n    if (this.ctx.store.tabs.has(tab)) {\n      this.api.tabs.onActivated(tab.id)\n    }\n  }\n\n  /**\n   * Add webContents to be tracked as an extension host which will receive\n   * extension events when a chrome-extension:// resource is loaded.\n   *\n   * This is usually reserved for extension background pages and popups, but\n   * can also be used in other special cases.\n   *\n   * @deprecated Extension hosts are now tracked lazily when they send\n   * extension IPCs to the main process.\n   */\n  addExtensionHost(host: Electron.WebContents) {\n    console.warn('ElectronChromeExtensions.addExtensionHost() is deprecated')\n  }\n\n  /**\n   * Get collection of menu items managed by the `chrome.contextMenus` API.\n   * @see https://developer.chrome.com/extensions/contextMenus\n   */\n  getContextMenuItems(webContents: Electron.WebContents, params: Electron.ContextMenuParams) {\n    return this.api.contextMenus.buildMenuItemsForParams(webContents, params)\n  }\n\n  /**\n   * Add extensions to be visible as an extension action button.\n   *\n   * @deprecated Not needed in Electron >=12.\n   */\n  addExtension(extension: Electron.Extension) {\n    console.warn('ElectronChromeExtensions.addExtension() is deprecated')\n    this.api.browserAction.processExtension(extension)\n  }\n\n  /**\n   * Remove extensions from the list of visible extension action buttons.\n   *\n   * @deprecated Not needed in Electron >=12.\n   */\n  removeExtension(extension: Electron.Extension) {\n    console.warn('ElectronChromeExtensions.removeExtension() is deprecated')\n    this.api.browserAction.removeActions(extension.id)\n  }\n}\n\n/**\n * @deprecated Use `ElectronChromeExtensions` instead.\n */\nexport const Extensions = ElectronChromeExtensions\n","import { BrowserWindow, Session } from 'electron'\n\nconst debug = require('debug')('electron-chrome-extensions:popup')\n\nexport interface PopupAnchorRect {\n  x: number\n  y: number\n  width: number\n  height: number\n}\n\ninterface PopupViewOptions {\n  extensionId: string\n  session: Session\n  parent: BrowserWindow\n  url: string\n  anchorRect: PopupAnchorRect\n}\n\nexport class PopupView {\n  static POSITION_PADDING = 5\n\n  static BOUNDS = {\n    minWidth: 25,\n    minHeight: 25,\n    maxWidth: 800,\n    maxHeight: 600,\n  }\n\n  browserWindow?: BrowserWindow\n  parent?: BrowserWindow\n  extensionId: string\n\n  private anchorRect: PopupAnchorRect\n  private destroyed: boolean = false\n\n  /** Preferred size changes are only received in Electron v12+ */\n  private usingPreferredSize = false\n\n  private readyPromise: Promise<void>\n\n  constructor(opts: PopupViewOptions) {\n    this.parent = opts.parent\n    this.extensionId = opts.extensionId\n    this.anchorRect = opts.anchorRect\n\n    this.browserWindow = new BrowserWindow({\n      show: false,\n      frame: false,\n      parent: opts.parent,\n      movable: false,\n      maximizable: false,\n      minimizable: false,\n      resizable: false,\n      skipTaskbar: true,\n      backgroundColor: '#ffffff',\n      webPreferences: {\n        session: opts.session,\n        sandbox: true,\n        nodeIntegration: false,\n        nodeIntegrationInWorker: false,\n        nativeWindowOpen: true,\n        worldSafeExecuteJavaScript: true,\n        contextIsolation: true,\n        ...({\n          enablePreferredSizeMode: true,\n        } as any),\n      },\n    })\n\n    const untypedWebContents = this.browserWindow.webContents as any\n    untypedWebContents.on('preferred-size-changed', this.updatePreferredSize)\n\n    this.browserWindow.webContents.on('devtools-closed', this.maybeClose)\n    this.browserWindow.on('blur', this.maybeClose)\n    this.browserWindow.on('closed', this.destroy)\n    this.parent.once('closed', this.destroy)\n\n    this.readyPromise = this.load(opts.url)\n  }\n\n  private async load(url: string): Promise<void> {\n    const win = this.browserWindow!\n\n    try {\n      await win.webContents.loadURL(url)\n    } catch (e) {\n      console.error(e)\n    }\n\n    if (this.destroyed) return\n\n    if (!this.usingPreferredSize) {\n      // Set large initial size to avoid overflow\n      this.setSize({ width: PopupView.BOUNDS.maxWidth, height: PopupView.BOUNDS.maxHeight })\n\n      // Wait for content and layout to load\n      await new Promise((resolve) => setTimeout(resolve, 100))\n      if (this.destroyed) return\n\n      await this.queryPreferredSize()\n      if (this.destroyed) return\n    }\n\n    win.show()\n  }\n\n  destroy = () => {\n    if (this.destroyed) return\n\n    this.destroyed = true\n\n    debug(`destroying ${this.extensionId}`)\n\n    if (this.parent) {\n      if (!this.parent.isDestroyed()) {\n        this.parent.off('closed', this.destroy)\n      }\n      this.parent = undefined\n    }\n\n    if (this.browserWindow) {\n      if (!this.browserWindow.isDestroyed()) {\n        const { webContents } = this.browserWindow\n\n        if (!webContents.isDestroyed() && webContents.isDevToolsOpened()) {\n          webContents.closeDevTools()\n        }\n\n        this.browserWindow.off('closed', this.destroy)\n        this.browserWindow.destroy()\n      }\n\n      this.browserWindow = undefined\n    }\n  }\n\n  isDestroyed() {\n    return this.destroyed\n  }\n\n  /** Resolves when the popup finishes loading. */\n  whenReady() {\n    return this.readyPromise\n  }\n\n  setSize(rect: Partial<Electron.Rectangle>) {\n    if (!this.browserWindow || !this.parent) return\n\n    const width = Math.floor(\n      Math.min(PopupView.BOUNDS.maxWidth, Math.max(rect.width || 0, PopupView.BOUNDS.minWidth))\n    )\n\n    const height = Math.floor(\n      Math.min(PopupView.BOUNDS.maxHeight, Math.max(rect.height || 0, PopupView.BOUNDS.minHeight))\n    )\n\n    debug(`setSize`, { width, height })\n\n    this.browserWindow?.setBounds({\n      ...this.browserWindow.getBounds(),\n      width,\n      height,\n    })\n  }\n\n  private maybeClose = () => {\n    // Keep open if webContents is being inspected\n    if (!this.browserWindow?.isDestroyed() && this.browserWindow?.webContents.isDevToolsOpened()) {\n      debug('preventing close due to DevTools being open')\n      return\n    }\n\n    // For extension popups with a login form, the user may need to access a\n    // program outside of the app. Closing the popup would then add\n    // inconvenience.\n    if (!BrowserWindow.getFocusedWindow()) {\n      debug('preventing close due to focus residing outside of the app')\n      return\n    }\n\n    this.destroy()\n  }\n\n  private updatePosition() {\n    if (!this.browserWindow || !this.parent) return\n\n    const winBounds = this.parent.getBounds()\n    const viewBounds = this.browserWindow.getBounds()\n\n    // TODO: support more orientations than just top-right\n    let x = winBounds.x + this.anchorRect.x + this.anchorRect.width - viewBounds.width\n    let y = winBounds.y + this.anchorRect.y + this.anchorRect.height + PopupView.POSITION_PADDING\n\n    // Convert to ints\n    x = Math.floor(x)\n    y = Math.floor(y)\n\n    debug(`updatePosition`, { x, y })\n\n    this.browserWindow.setBounds({\n      ...this.browserWindow.getBounds(),\n      x,\n      y,\n    })\n  }\n\n  /** Backwards compat for Electron <12 */\n  private async queryPreferredSize() {\n    if (this.usingPreferredSize || this.destroyed) return\n\n    const rect = await this.browserWindow!.webContents.executeJavaScript(\n      `((${() => {\n        const rect = document.body.getBoundingClientRect()\n        return { width: rect.width, height: rect.height }\n      }})())`\n    )\n\n    if (this.destroyed) return\n\n    this.setSize({ width: rect.width, height: rect.height })\n    this.updatePosition()\n  }\n\n  private updatePreferredSize = (event: Electron.Event, size: Electron.Size) => {\n    debug('updatePreferredSize', size)\n    this.usingPreferredSize = true\n    this.setSize(size)\n    this.updatePosition()\n  }\n}\n","import { app, Extension, ipcMain, session, Session, WebContents } from 'electron'\n\nimport createDebug from 'debug'\nimport { formatIpcName } from '../isomorphic/ipc'\n\n// Shorten base64 encoded icons\nconst shortenValues = (k: string, v: any) =>\n  typeof v === 'string' && v.length > 128 ? v.substr(0, 128) + '...' : v\n\ncreateDebug.formatters.r = (value: any) => {\n  return value ? JSON.stringify(value, shortenValues, '  ') : value\n}\n\nconst debug = createDebug('electron-chrome-extensions:router')\n\nconst DEFAULT_SESSION = '_self'\n\ninterface RoutingDelegateObserver {\n  session: Electron.Session\n  onExtensionMessage(\n    event: Electron.IpcMainInvokeEvent,\n    extensionId: string | undefined,\n    handlerName: string,\n    ...args: any[]\n  ): Promise<void>\n  addListener(listener: EventListener, extensionId: string, eventName: string): void\n  removeListener(listener: EventListener, extensionId: string, eventName: string): void\n}\n\nlet gRoutingDelegate: RoutingDelegate\n\n/**\n * Handles event routing IPCs and delivers them to the observer with the\n * associated session.\n */\nclass RoutingDelegate {\n  static get() {\n    return gRoutingDelegate || (gRoutingDelegate = new RoutingDelegate())\n  }\n\n  private sessionMap: WeakMap<Session, RoutingDelegateObserver> = new WeakMap()\n\n  private constructor() {\n    ipcMain.handle('crx-msg', this.onRouterMessage)\n    ipcMain.handle('crx-msg-remote', this.onRemoteMessage)\n    ipcMain.on('crx-add-listener', this.onAddListener)\n    ipcMain.on('crx-remove-listener', this.onRemoveListener)\n  }\n\n  addObserver(observer: RoutingDelegateObserver) {\n    this.sessionMap.set(observer.session, observer)\n  }\n\n  private onRouterMessage = async (\n    event: Electron.IpcMainInvokeEvent,\n    extensionId: string,\n    handlerName: string,\n    ...args: any[]\n  ) => {\n    debug(`received '${handlerName}'`, args)\n\n    const observer = this.sessionMap.get(event.sender.session)\n\n    return observer?.onExtensionMessage(event, extensionId, handlerName, ...args)\n  }\n\n  private onRemoteMessage = async (\n    event: Electron.IpcMainInvokeEvent,\n    sessionPartition: string,\n    handlerName: string,\n    ...args: any[]\n  ) => {\n    debug(`received remote '${handlerName}' for '${sessionPartition}'`, args)\n\n    const ses =\n      sessionPartition === DEFAULT_SESSION\n        ? event.sender.session\n        : session.fromPartition(sessionPartition)\n\n    const observer = this.sessionMap.get(ses)\n\n    return observer?.onExtensionMessage(event, undefined, handlerName, ...args)\n  }\n\n  private onAddListener = (\n    event: Electron.IpcMainInvokeEvent,\n    extensionId: string,\n    eventName: string\n  ) => {\n    const observer = this.sessionMap.get(event.sender.session)\n    const listener: EventListener = { host: event.sender, extensionId }\n    return observer?.addListener(listener, extensionId, eventName)\n  }\n\n  private onRemoveListener = (\n    event: Electron.IpcMainInvokeEvent,\n    extensionId: string,\n    eventName: string\n  ) => {\n    const observer = this.sessionMap.get(event.sender.session)\n    const listener: EventListener = { host: event.sender, extensionId }\n    return observer?.removeListener(listener, extensionId, eventName)\n  }\n}\n\nexport interface ExtensionEvent {\n  sender: WebContents\n  extension: Extension\n}\n\nexport type HandlerCallback = (event: ExtensionEvent, ...args: any[]) => any\n\nexport interface HandlerOptions {\n  /** Whether the handler can be invoked on behalf of a different session. */\n  allowRemote?: boolean\n  /** Whether an extension context is required to invoke the handler. */\n  extensionContext: boolean\n}\n\ninterface Handler extends HandlerOptions {\n  callback: HandlerCallback\n}\n\n/** e.g. 'tabs.query' */\ntype EventName = string\n\ntype HandlerMap = Map<EventName, Handler>\n\ninterface EventListener {\n  host: Electron.WebContents\n  extensionId: string\n}\n\nconst eventListenerEquals = (eventListener: EventListener) => (other: EventListener) =>\n  other.host === eventListener.host && other.extensionId === eventListener.extensionId\n\nexport class ExtensionRouter implements RoutingDelegateObserver {\n  private handlers: HandlerMap = new Map()\n  private listeners: Map<EventName, EventListener[]> = new Map()\n\n  /**\n   * Collection of all extension hosts in the session.\n   *\n   * Currently the router has no ability to wake up non-persistent background\n   * scripts to deliver events. For now we just hold a reference to them to\n   * prevent them from being terminated.\n   */\n  private extensionHosts: Set<Electron.WebContents> = new Set()\n\n  constructor(\n    public session: Electron.Session,\n    private delegate: RoutingDelegate = RoutingDelegate.get()\n  ) {\n    this.delegate.addObserver(this)\n\n    session.on('extension-unloaded', (event, extension) => {\n      this.filterListeners((listener) => listener.extensionId !== extension.id)\n    })\n\n    app.on('web-contents-created', (event, webContents) => {\n      if (webContents.session === this.session && webContents.getType() === 'backgroundPage') {\n        debug(`storing reference to background host [url:'${webContents.getURL()}']`)\n        this.extensionHosts.add(webContents)\n      }\n    })\n  }\n\n  private filterListeners(predicate: (listener: EventListener) => boolean) {\n    for (const [eventName, listeners] of this.listeners) {\n      const filteredListeners = listeners.filter(predicate)\n      const delta = listeners.length - filteredListeners.length\n\n      if (filteredListeners.length > 0) {\n        this.listeners.set(eventName, filteredListeners)\n      } else {\n        this.listeners.delete(eventName)\n      }\n\n      if (delta > 0) {\n        debug(`removed ${delta} listener(s) for '${eventName}'`)\n      }\n    }\n  }\n\n  private observeListenerHost(host: EventListener['host']) {\n    debug(`observing listener [id:${host.id}, url:'${host.getURL()}']`)\n    host.once('destroyed', () => {\n      debug(`extension host destroyed [id:${host.id}]`)\n      this.filterListeners((listener) => listener.host !== host)\n    })\n  }\n\n  addListener(listener: EventListener, extensionId: string, eventName: string) {\n    const { listeners, session } = this\n\n    const extension = session.getExtension(extensionId)\n    if (!extension) {\n      throw new Error(`extension not registered in session [extensionId:${extensionId}]`)\n    }\n\n    if (!listeners.has(eventName)) {\n      listeners.set(eventName, [])\n    }\n\n    const eventListeners = listeners.get(eventName)!\n    const existingEventListener = eventListeners.find(eventListenerEquals(listener))\n\n    if (existingEventListener) {\n      debug(`ignoring existing '${eventName}' event listener for ${extensionId}`)\n    } else {\n      debug(`adding '${eventName}' event listener for ${extensionId}`)\n      eventListeners.push(listener)\n      this.observeListenerHost(listener.host)\n    }\n  }\n\n  removeListener(listener: EventListener, extensionId: string, eventName: string) {\n    const { listeners } = this\n\n    const eventListeners = listeners.get(eventName)\n    if (!eventListeners) {\n      console.error(`event listener not registered for '${eventName}'`)\n      return\n    }\n\n    const index = eventListeners.findIndex(eventListenerEquals(listener))\n\n    if (index >= 0) {\n      debug(`removing '${eventName}' event listener for ${extensionId}`)\n      eventListeners.splice(index, 1)\n    }\n\n    if (eventListeners.length === 0) {\n      listeners.delete(eventName)\n    }\n  }\n\n  private getHandler(handlerName: string) {\n    const handler = this.handlers.get(handlerName)\n    if (!handler) {\n      throw new Error(`${handlerName} is not a registered handler`)\n    }\n\n    return handler\n  }\n\n  async onExtensionMessage(\n    event: Electron.IpcMainInvokeEvent,\n    extensionId: string | undefined,\n    handlerName: string,\n    ...args: any[]\n  ) {\n    const { session } = this\n    const { sender } = event\n    const handler = this.getHandler(handlerName)\n\n    if (sender.session !== session && !handler.allowRemote) {\n      throw new Error(`${handlerName} does not support calling from a remote session`)\n    }\n\n    const extension = extensionId ? sender.session.getExtension(extensionId) : undefined\n    if (!extension && handler.extensionContext) {\n      throw new Error(`${handlerName} was sent from an unknown extension context`)\n    }\n\n    const extEvent = {\n      sender,\n      extension: extension!,\n    }\n\n    const result = await handler.callback(extEvent, ...args)\n\n    debug(`${handlerName} result: %r`, result)\n\n    return result\n  }\n\n  private handle(name: string, callback: HandlerCallback, opts?: HandlerOptions): void {\n    this.handlers.set(name, {\n      callback,\n      extensionContext: typeof opts?.extensionContext === 'boolean' ? opts.extensionContext : true,\n      allowRemote: typeof opts?.allowRemote === 'boolean' ? opts.allowRemote : false,\n    })\n  }\n\n  /** Returns a callback to register API handlers for the given context. */\n  apiHandler() {\n    return (name: string, callback: HandlerCallback, opts?: HandlerOptions) => {\n      this.handle(name, callback, opts)\n    }\n  }\n\n  /**\n   * Sends extension event to the host for the given extension ID if it\n   * registered a listener for it.\n   */\n  sendEvent(extensionId: string | undefined, eventName: string, ...args: any[]) {\n    const { listeners } = this\n\n    let eventListeners = listeners.get(eventName)\n\n    if (extensionId) {\n      // TODO: extension permissions check\n      debug(`sendEvent '${eventName}' to extension '${extensionId}'`)\n      eventListeners = eventListeners?.filter((el) => el.extensionId === extensionId)\n    } else {\n      debug(`broadcast event '${eventName}' to all extensions`)\n    }\n\n    if (!eventListeners || eventListeners.length === 0) {\n      debug(`ignoring '${eventName}' event with no listeners`)\n      return\n    }\n\n    for (const { host } of eventListeners) {\n      // TODO: may need to wake lazy extension context\n      if (host.isDestroyed()) {\n        console.error(`Unable to send '${eventName}' to extension host for ${extensionId}`)\n        continue\n      }\n\n      host.send(formatIpcName(eventName), ...args)\n    }\n  }\n\n  /** Broadcasts extension event to all extension hosts listening for it. */\n  broadcastEvent(eventName: string, ...args: any[]) {\n    this.sendEvent(undefined, eventName, ...args)\n  }\n}\n","import { BrowserWindow, webContents } from 'electron';\nimport { EventEmitter } from 'events';\nimport { ContextMenuType } from './api/common';\nimport { ChromeExtensionImpl } from './impl';\nimport { ExtensionEvent } from './router';\n\nconst debug = require('debug')('electron-chrome-extensions:store');\n\nexport class ExtensionStore extends EventEmitter {\n    /** Tabs observed by the extensions system. */\n    tabs = new Set<Electron.WebContents>();\n\n    /** Windows observed by the extensions system. */\n    windows = new Set<Electron.BrowserWindow>();\n\n    lastFocusedWindowId?: number;\n\n    /**\n     * Map of tabs to their parent window.\n     *\n     * It's not possible to access the parent of a BrowserView so we must manage\n     * this ourselves.\n     */\n    tabToWindow = new WeakMap<Electron.WebContents, Electron.BrowserWindow>();\n\n    /** Map of windows to their active tab. */\n    private windowToActiveTab = new WeakMap<\n        Electron.BrowserWindow,\n        Electron.WebContents\n    >();\n\n    tabDetailsCache = new Map<number, Partial<chrome.tabs.Tab>>();\n    windowDetailsCache = new Map<number, Partial<chrome.windows.Window>>();\n\n    constructor(public impl: ChromeExtensionImpl) {\n        super();\n    }\n\n    async getWindowById(event: ExtensionEvent, windowId: number) {\n        const foundWindow = this.findWindowById(windowId);\n        const window = this.impl.getWindowById?.(\n            { event, foundWindow },\n            windowId\n        );\n\n        return window || foundWindow || null;\n    }\n\n    findWindowById(windowId: number) {\n        return Array.from(this.windows).find(\n            (window) => !window.isDestroyed() && window.id === windowId\n        );\n    }\n\n    getLastFocusedWindow() {\n        return this.lastFocusedWindowId\n            ? this.findWindowById(this.lastFocusedWindowId) || null\n            : null;\n    }\n\n    addWindow(window: Electron.BrowserWindow) {\n        if (this.windows.has(window)) return;\n\n        this.windows.add(window);\n\n        if (typeof this.lastFocusedWindowId !== 'number') {\n            this.lastFocusedWindowId = window.id;\n        }\n\n        this.emit('window-added', window);\n    }\n\n    async windowsGetCurrent(event: ExtensionEvent) {\n        const wc = event.sender;\n        let win = this.tabToWindow.get(wc) || BrowserWindow.fromWebContents(wc);\n        if (typeof this.impl.windowsGetCurrent === 'function') {\n            const lastFocusedWindow = this.getLastFocusedWindow();\n            win = await this.impl.windowsGetCurrent(win, {\n                event,\n                lastFocusedWindow,\n            });\n        }\n\n        return win;\n    }\n\n    async createWindow(\n        event: ExtensionEvent,\n        details: chrome.windows.CreateData\n    ) {\n        if (typeof this.impl.createWindow !== 'function') {\n            throw new Error('createWindow is not implemented');\n        }\n\n        const win = await this.impl.createWindow(details, { event });\n\n        this.addWindow(win);\n\n        return win;\n    }\n\n    removeWindow(window: Electron.BrowserWindow) {\n        if (!this.windows.has(window)) return;\n\n        this.windows.delete(window);\n\n        if (typeof this.impl.removeWindow === 'function') {\n            this.impl.removeWindow(window);\n        } else {\n            window.destroy();\n        }\n    }\n\n    getTabById(tabId: number) {\n        return Array.from(this.tabs).find(\n            (tab) => !tab.isDestroyed() && tab.id === tabId\n        );\n    }\n\n    addTab(tab: Electron.WebContents, window: Electron.BrowserWindow) {\n        if (this.tabs.has(tab)) return;\n\n        this.tabs.add(tab);\n        this.tabToWindow.set(tab, window);\n        this.addWindow(window);\n\n        const activeTab = this.getActiveTabFromWebContents(tab);\n        if (!activeTab) {\n            this.setActiveTab(tab);\n        }\n\n        this.emit('tab-added', tab);\n    }\n\n    removeTab(tab: Electron.WebContents) {\n        if (!this.tabs.has(tab)) return;\n\n        const tabId = tab.id;\n        const win = this.tabToWindow.get(tab)!;\n\n        this.tabs.delete(tab);\n        this.tabToWindow.delete(tab);\n\n        // TODO: clear active tab\n        (async () => {\n            const behaviors = await this.impl.getTabbedBrowserWindowBehavior?.({\n                tabs: this.tabs,\n                window: win,\n            });\n            // Clear window if it has no remaining tabs\n            const windowHasTabs = Array.from(this.tabs).find(\n                (tab) => this.tabToWindow.get(tab) === win\n            );\n            if (!windowHasTabs && !behaviors?.keepRefWindowOnAllTabsClosed) {\n                // TODO: maybe we should check if windows destroyed to determine if we should dispose all listeners on it.\n                this.windows.delete(win);\n            }\n\n            if (typeof this.impl.removeTab === 'function') {\n                this.impl.removeTab(tab, win);\n            }\n\n            this.emit('tab-removed', tabId);\n        })();\n    }\n\n    async createTab(\n        details: chrome.tabs.CreateProperties,\n        event: ExtensionEvent\n    ) {\n        if (typeof this.impl.createTab !== 'function') {\n            throw new Error('createTab is not implemented');\n        }\n\n        // Fallback to current window\n        if (!details.windowId) {\n            details.windowId = this.lastFocusedWindowId;\n        }\n\n        const result = await this.impl.createTab(details, { event });\n        if (!result) return result;\n\n        if (!Array.isArray(result)) {\n            throw new Error('createTab must return an array of [tab, window]');\n        }\n\n        const [tab, window] = result;\n\n        if (typeof tab !== 'object' || !webContents.fromId(tab.id)) {\n            throw new Error('createTab must return a WebContents');\n        } else if (typeof window !== 'object') {\n            throw new Error('createTab must return a BrowserWindow');\n        }\n\n        this.addTab(tab, window);\n\n        return tab;\n    }\n\n    getActiveTabFromWindow(win: Electron.BrowserWindow) {\n        const activeTab =\n            win && !win.isDestroyed() && this.windowToActiveTab.get(win);\n        return (\n            (activeTab && !activeTab.isDestroyed() && activeTab) || undefined\n        );\n    }\n\n    getActiveTabFromWebContents(\n        wc: Electron.WebContents\n    ): Electron.WebContents | undefined {\n        const win =\n            this.tabToWindow.get(wc) || BrowserWindow.fromWebContents(wc);\n        return win ? this.getActiveTabFromWindow(win) : undefined;\n    }\n\n    getActiveTabOfCurrentWindow() {\n        const win = this.getLastFocusedWindow();\n        return win ? this.getActiveTabFromWindow(win) : undefined;\n    }\n\n    setActiveTab(tab: Electron.WebContents) {\n        const win = this.tabToWindow.get(tab);\n        if (!win) {\n            throw new Error('Active tab has no parent window');\n        }\n\n        const prevActiveTab = this.getActiveTabFromWebContents(tab);\n\n        this.windowToActiveTab.set(win, tab);\n\n        if (tab.id !== prevActiveTab?.id) {\n            this.emit('active-tab-changed', tab, win);\n\n            if (typeof this.impl.selectTab === 'function') {\n                this.impl.selectTab(tab, win);\n            }\n        }\n    }\n\n    buildMenuItems(\n        extensionId: string,\n        menuType: ContextMenuType\n    ): Electron.MenuItem[] {\n        // This function is overwritten by ContextMenusAPI\n        return [];\n    }\n}\n","export function ensureSuffix (str: string = '', suffix: string = '/') {\n    if (str.endsWith(suffix)) return str\n    return str + suffix\n}\nexport function unPrefix (str: string = '', prefix: string | string[] = '/') {\n    const prefixes = Array.isArray(prefix) ? prefix : [prefix];\n\n    let ret = str;\n    prefixes.forEach(prefix => {\n        if (ret.startsWith(prefix)) ret = ret.slice(prefix.length)\n    });\n\n    return ret\n}","export const formatIpcName = (name: string) => `crx-${name}`","/* eslint-env browser */\n\n/**\n * This is the web browser implementation of `debug()`.\n */\n\nexports.formatArgs = formatArgs;\nexports.save = save;\nexports.load = load;\nexports.useColors = useColors;\nexports.storage = localstorage();\nexports.destroy = (() => {\n\tlet warned = false;\n\n\treturn () => {\n\t\tif (!warned) {\n\t\t\twarned = true;\n\t\t\tconsole.warn('Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.');\n\t\t}\n\t};\n})();\n\n/**\n * Colors.\n */\n\nexports.colors = [\n\t'#0000CC',\n\t'#0000FF',\n\t'#0033CC',\n\t'#0033FF',\n\t'#0066CC',\n\t'#0066FF',\n\t'#0099CC',\n\t'#0099FF',\n\t'#00CC00',\n\t'#00CC33',\n\t'#00CC66',\n\t'#00CC99',\n\t'#00CCCC',\n\t'#00CCFF',\n\t'#3300CC',\n\t'#3300FF',\n\t'#3333CC',\n\t'#3333FF',\n\t'#3366CC',\n\t'#3366FF',\n\t'#3399CC',\n\t'#3399FF',\n\t'#33CC00',\n\t'#33CC33',\n\t'#33CC66',\n\t'#33CC99',\n\t'#33CCCC',\n\t'#33CCFF',\n\t'#6600CC',\n\t'#6600FF',\n\t'#6633CC',\n\t'#6633FF',\n\t'#66CC00',\n\t'#66CC33',\n\t'#9900CC',\n\t'#9900FF',\n\t'#9933CC',\n\t'#9933FF',\n\t'#99CC00',\n\t'#99CC33',\n\t'#CC0000',\n\t'#CC0033',\n\t'#CC0066',\n\t'#CC0099',\n\t'#CC00CC',\n\t'#CC00FF',\n\t'#CC3300',\n\t'#CC3333',\n\t'#CC3366',\n\t'#CC3399',\n\t'#CC33CC',\n\t'#CC33FF',\n\t'#CC6600',\n\t'#CC6633',\n\t'#CC9900',\n\t'#CC9933',\n\t'#CCCC00',\n\t'#CCCC33',\n\t'#FF0000',\n\t'#FF0033',\n\t'#FF0066',\n\t'#FF0099',\n\t'#FF00CC',\n\t'#FF00FF',\n\t'#FF3300',\n\t'#FF3333',\n\t'#FF3366',\n\t'#FF3399',\n\t'#FF33CC',\n\t'#FF33FF',\n\t'#FF6600',\n\t'#FF6633',\n\t'#FF9900',\n\t'#FF9933',\n\t'#FFCC00',\n\t'#FFCC33'\n];\n\n/**\n * Currently only WebKit-based Web Inspectors, Firefox >= v31,\n * and the Firebug extension (any Firefox version) are known\n * to support \"%c\" CSS customizations.\n *\n * TODO: add a `localStorage` variable to explicitly enable/disable colors\n */\n\n// eslint-disable-next-line complexity\nfunction useColors() {\n\t// NB: In an Electron preload script, document will be defined but not fully\n\t// initialized. Since we know we're in Chrome, we'll just detect this case\n\t// explicitly\n\tif (typeof window !== 'undefined' && window.process && (window.process.type === 'renderer' || window.process.__nwjs)) {\n\t\treturn true;\n\t}\n\n\t// Internet Explorer and Edge do not support colors.\n\tif (typeof navigator !== 'undefined' && navigator.userAgent && navigator.userAgent.toLowerCase().match(/(edge|trident)\\/(\\d+)/)) {\n\t\treturn false;\n\t}\n\n\t// Is webkit? http://stackoverflow.com/a/16459606/376773\n\t// document is undefined in react-native: https://github.com/facebook/react-native/pull/1632\n\treturn (typeof document !== 'undefined' && document.documentElement && document.documentElement.style && document.documentElement.style.WebkitAppearance) ||\n\t\t// Is firebug? http://stackoverflow.com/a/398120/376773\n\t\t(typeof window !== 'undefined' && window.console && (window.console.firebug || (window.console.exception && window.console.table))) ||\n\t\t// Is firefox >= v31?\n\t\t// https://developer.mozilla.org/en-US/docs/Tools/Web_Console#Styling_messages\n\t\t(typeof navigator !== 'undefined' && navigator.userAgent && navigator.userAgent.toLowerCase().match(/firefox\\/(\\d+)/) && parseInt(RegExp.$1, 10) >= 31) ||\n\t\t// Double check webkit in userAgent just in case we are in a worker\n\t\t(typeof navigator !== 'undefined' && navigator.userAgent && navigator.userAgent.toLowerCase().match(/applewebkit\\/(\\d+)/));\n}\n\n/**\n * Colorize log arguments if enabled.\n *\n * @api public\n */\n\nfunction formatArgs(args) {\n\targs[0] = (this.useColors ? '%c' : '') +\n\t\tthis.namespace +\n\t\t(this.useColors ? ' %c' : ' ') +\n\t\targs[0] +\n\t\t(this.useColors ? '%c ' : ' ') +\n\t\t'+' + module.exports.humanize(this.diff);\n\n\tif (!this.useColors) {\n\t\treturn;\n\t}\n\n\tconst c = 'color: ' + this.color;\n\targs.splice(1, 0, c, 'color: inherit');\n\n\t// The final \"%c\" is somewhat tricky, because there could be other\n\t// arguments passed either before or after the %c, so we need to\n\t// figure out the correct index to insert the CSS into\n\tlet index = 0;\n\tlet lastC = 0;\n\targs[0].replace(/%[a-zA-Z%]/g, match => {\n\t\tif (match === '%%') {\n\t\t\treturn;\n\t\t}\n\t\tindex++;\n\t\tif (match === '%c') {\n\t\t\t// We only are interested in the *last* %c\n\t\t\t// (the user may have provided their own)\n\t\t\tlastC = index;\n\t\t}\n\t});\n\n\targs.splice(lastC, 0, c);\n}\n\n/**\n * Invokes `console.debug()` when available.\n * No-op when `console.debug` is not a \"function\".\n * If `console.debug` is not available, falls back\n * to `console.log`.\n *\n * @api public\n */\nexports.log = console.debug || console.log || (() => {});\n\n/**\n * Save `namespaces`.\n *\n * @param {String} namespaces\n * @api private\n */\nfunction save(namespaces) {\n\ttry {\n\t\tif (namespaces) {\n\t\t\texports.storage.setItem('debug', namespaces);\n\t\t} else {\n\t\t\texports.storage.removeItem('debug');\n\t\t}\n\t} catch (error) {\n\t\t// Swallow\n\t\t// XXX (@Qix-) should we be logging these?\n\t}\n}\n\n/**\n * Load `namespaces`.\n *\n * @return {String} returns the previously persisted debug modes\n * @api private\n */\nfunction load() {\n\tlet r;\n\ttry {\n\t\tr = exports.storage.getItem('debug');\n\t} catch (error) {\n\t\t// Swallow\n\t\t// XXX (@Qix-) should we be logging these?\n\t}\n\n\t// If debug isn't set in LS, and we're in Electron, try to load $DEBUG\n\tif (!r && typeof process !== 'undefined' && 'env' in process) {\n\t\tr = process.env.DEBUG;\n\t}\n\n\treturn r;\n}\n\n/**\n * Localstorage attempts to return the localstorage.\n *\n * This is necessary because safari throws\n * when a user disables cookies/localstorage\n * and you attempt to access it.\n *\n * @return {LocalStorage}\n * @api private\n */\n\nfunction localstorage() {\n\ttry {\n\t\t// TVMLKit (Apple TV JS Runtime) does not have a window object, just localStorage in the global context\n\t\t// The Browser also has localStorage in the global context.\n\t\treturn localStorage;\n\t} catch (error) {\n\t\t// Swallow\n\t\t// XXX (@Qix-) should we be logging these?\n\t}\n}\n\nmodule.exports = require('./common')(exports);\n\nconst {formatters} = module.exports;\n\n/**\n * Map %j to `JSON.stringify()`, since no Web Inspectors do that by default.\n */\n\nformatters.j = function (v) {\n\ttry {\n\t\treturn JSON.stringify(v);\n\t} catch (error) {\n\t\treturn '[UnexpectedJSONParseError]: ' + error.message;\n\t}\n};\n","\n/**\n * This is the common logic for both the Node.js and web browser\n * implementations of `debug()`.\n */\n\nfunction setup(env) {\n\tcreateDebug.debug = createDebug;\n\tcreateDebug.default = createDebug;\n\tcreateDebug.coerce = coerce;\n\tcreateDebug.disable = disable;\n\tcreateDebug.enable = enable;\n\tcreateDebug.enabled = enabled;\n\tcreateDebug.humanize = require('ms');\n\tcreateDebug.destroy = destroy;\n\n\tObject.keys(env).forEach(key => {\n\t\tcreateDebug[key] = env[key];\n\t});\n\n\t/**\n\t* The currently active debug mode names, and names to skip.\n\t*/\n\n\tcreateDebug.names = [];\n\tcreateDebug.skips = [];\n\n\t/**\n\t* Map of special \"%n\" handling functions, for the debug \"format\" argument.\n\t*\n\t* Valid key names are a single, lower or upper-case letter, i.e. \"n\" and \"N\".\n\t*/\n\tcreateDebug.formatters = {};\n\n\t/**\n\t* Selects a color for a debug namespace\n\t* @param {String} namespace The namespace string for the debug instance to be colored\n\t* @return {Number|String} An ANSI color code for the given namespace\n\t* @api private\n\t*/\n\tfunction selectColor(namespace) {\n\t\tlet hash = 0;\n\n\t\tfor (let i = 0; i < namespace.length; i++) {\n\t\t\thash = ((hash << 5) - hash) + namespace.charCodeAt(i);\n\t\t\thash |= 0; // Convert to 32bit integer\n\t\t}\n\n\t\treturn createDebug.colors[Math.abs(hash) % createDebug.colors.length];\n\t}\n\tcreateDebug.selectColor = selectColor;\n\n\t/**\n\t* Create a debugger with the given `namespace`.\n\t*\n\t* @param {String} namespace\n\t* @return {Function}\n\t* @api public\n\t*/\n\tfunction createDebug(namespace) {\n\t\tlet prevTime;\n\t\tlet enableOverride = null;\n\t\tlet namespacesCache;\n\t\tlet enabledCache;\n\n\t\tfunction debug(...args) {\n\t\t\t// Disabled?\n\t\t\tif (!debug.enabled) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst self = debug;\n\n\t\t\t// Set `diff` timestamp\n\t\t\tconst curr = Number(new Date());\n\t\t\tconst ms = curr - (prevTime || curr);\n\t\t\tself.diff = ms;\n\t\t\tself.prev = prevTime;\n\t\t\tself.curr = curr;\n\t\t\tprevTime = curr;\n\n\t\t\targs[0] = createDebug.coerce(args[0]);\n\n\t\t\tif (typeof args[0] !== 'string') {\n\t\t\t\t// Anything else let's inspect with %O\n\t\t\t\targs.unshift('%O');\n\t\t\t}\n\n\t\t\t// Apply any `formatters` transformations\n\t\t\tlet index = 0;\n\t\t\targs[0] = args[0].replace(/%([a-zA-Z%])/g, (match, format) => {\n\t\t\t\t// If we encounter an escaped % then don't increase the array index\n\t\t\t\tif (match === '%%') {\n\t\t\t\t\treturn '%';\n\t\t\t\t}\n\t\t\t\tindex++;\n\t\t\t\tconst formatter = createDebug.formatters[format];\n\t\t\t\tif (typeof formatter === 'function') {\n\t\t\t\t\tconst val = args[index];\n\t\t\t\t\tmatch = formatter.call(self, val);\n\n\t\t\t\t\t// Now we need to remove `args[index]` since it's inlined in the `format`\n\t\t\t\t\targs.splice(index, 1);\n\t\t\t\t\tindex--;\n\t\t\t\t}\n\t\t\t\treturn match;\n\t\t\t});\n\n\t\t\t// Apply env-specific formatting (colors, etc.)\n\t\t\tcreateDebug.formatArgs.call(self, args);\n\n\t\t\tconst logFn = self.log || createDebug.log;\n\t\t\tlogFn.apply(self, args);\n\t\t}\n\n\t\tdebug.namespace = namespace;\n\t\tdebug.useColors = createDebug.useColors();\n\t\tdebug.color = createDebug.selectColor(namespace);\n\t\tdebug.extend = extend;\n\t\tdebug.destroy = createDebug.destroy; // XXX Temporary. Will be removed in the next major release.\n\n\t\tObject.defineProperty(debug, 'enabled', {\n\t\t\tenumerable: true,\n\t\t\tconfigurable: false,\n\t\t\tget: () => {\n\t\t\t\tif (enableOverride !== null) {\n\t\t\t\t\treturn enableOverride;\n\t\t\t\t}\n\t\t\t\tif (namespacesCache !== createDebug.namespaces) {\n\t\t\t\t\tnamespacesCache = createDebug.namespaces;\n\t\t\t\t\tenabledCache = createDebug.enabled(namespace);\n\t\t\t\t}\n\n\t\t\t\treturn enabledCache;\n\t\t\t},\n\t\t\tset: v => {\n\t\t\t\tenableOverride = v;\n\t\t\t}\n\t\t});\n\n\t\t// Env-specific initialization logic for debug instances\n\t\tif (typeof createDebug.init === 'function') {\n\t\t\tcreateDebug.init(debug);\n\t\t}\n\n\t\treturn debug;\n\t}\n\n\tfunction extend(namespace, delimiter) {\n\t\tconst newDebug = createDebug(this.namespace + (typeof delimiter === 'undefined' ? ':' : delimiter) + namespace);\n\t\tnewDebug.log = this.log;\n\t\treturn newDebug;\n\t}\n\n\t/**\n\t* Enables a debug mode by namespaces. This can include modes\n\t* separated by a colon and wildcards.\n\t*\n\t* @param {String} namespaces\n\t* @api public\n\t*/\n\tfunction enable(namespaces) {\n\t\tcreateDebug.save(namespaces);\n\t\tcreateDebug.namespaces = namespaces;\n\n\t\tcreateDebug.names = [];\n\t\tcreateDebug.skips = [];\n\n\t\tlet i;\n\t\tconst split = (typeof namespaces === 'string' ? namespaces : '').split(/[\\s,]+/);\n\t\tconst len = split.length;\n\n\t\tfor (i = 0; i < len; i++) {\n\t\t\tif (!split[i]) {\n\t\t\t\t// ignore empty strings\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tnamespaces = split[i].replace(/\\*/g, '.*?');\n\n\t\t\tif (namespaces[0] === '-') {\n\t\t\t\tcreateDebug.skips.push(new RegExp('^' + namespaces.slice(1) + '$'));\n\t\t\t} else {\n\t\t\t\tcreateDebug.names.push(new RegExp('^' + namespaces + '$'));\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t* Disable debug output.\n\t*\n\t* @return {String} namespaces\n\t* @api public\n\t*/\n\tfunction disable() {\n\t\tconst namespaces = [\n\t\t\t...createDebug.names.map(toNamespace),\n\t\t\t...createDebug.skips.map(toNamespace).map(namespace => '-' + namespace)\n\t\t].join(',');\n\t\tcreateDebug.enable('');\n\t\treturn namespaces;\n\t}\n\n\t/**\n\t* Returns true if the given mode name is enabled, false otherwise.\n\t*\n\t* @param {String} name\n\t* @return {Boolean}\n\t* @api public\n\t*/\n\tfunction enabled(name) {\n\t\tif (name[name.length - 1] === '*') {\n\t\t\treturn true;\n\t\t}\n\n\t\tlet i;\n\t\tlet len;\n\n\t\tfor (i = 0, len = createDebug.skips.length; i < len; i++) {\n\t\t\tif (createDebug.skips[i].test(name)) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\n\t\tfor (i = 0, len = createDebug.names.length; i < len; i++) {\n\t\t\tif (createDebug.names[i].test(name)) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\n\t\treturn false;\n\t}\n\n\t/**\n\t* Convert regexp to namespace\n\t*\n\t* @param {RegExp} regxep\n\t* @return {String} namespace\n\t* @api private\n\t*/\n\tfunction toNamespace(regexp) {\n\t\treturn regexp.toString()\n\t\t\t.substring(2, regexp.toString().length - 2)\n\t\t\t.replace(/\\.\\*\\?$/, '*');\n\t}\n\n\t/**\n\t* Coerce `val`.\n\t*\n\t* @param {Mixed} val\n\t* @return {Mixed}\n\t* @api private\n\t*/\n\tfunction coerce(val) {\n\t\tif (val instanceof Error) {\n\t\t\treturn val.stack || val.message;\n\t\t}\n\t\treturn val;\n\t}\n\n\t/**\n\t* XXX DO NOT USE. This is a temporary stub function.\n\t* XXX It WILL be removed in the next major release.\n\t*/\n\tfunction destroy() {\n\t\tconsole.warn('Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.');\n\t}\n\n\tcreateDebug.enable(createDebug.load());\n\n\treturn createDebug;\n}\n\nmodule.exports = setup;\n","/**\n * Detect Electron renderer / nwjs process, which is node, but we should\n * treat as a browser.\n */\n\nif (typeof process === 'undefined' || process.type === 'renderer' || process.browser === true || process.__nwjs) {\n\tmodule.exports = require('./browser.js');\n} else {\n\tmodule.exports = require('./node.js');\n}\n","/**\n * Module dependencies.\n */\n\nconst tty = require('tty');\nconst util = require('util');\n\n/**\n * This is the Node.js implementation of `debug()`.\n */\n\nexports.init = init;\nexports.log = log;\nexports.formatArgs = formatArgs;\nexports.save = save;\nexports.load = load;\nexports.useColors = useColors;\nexports.destroy = util.deprecate(\n\t() => {},\n\t'Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.'\n);\n\n/**\n * Colors.\n */\n\nexports.colors = [6, 2, 3, 4, 5, 1];\n\ntry {\n\t// Optional dependency (as in, doesn't need to be installed, NOT like optionalDependencies in package.json)\n\t// eslint-disable-next-line import/no-extraneous-dependencies\n\tconst supportsColor = require('supports-color');\n\n\tif (supportsColor && (supportsColor.stderr || supportsColor).level >= 2) {\n\t\texports.colors = [\n\t\t\t20,\n\t\t\t21,\n\t\t\t26,\n\t\t\t27,\n\t\t\t32,\n\t\t\t33,\n\t\t\t38,\n\t\t\t39,\n\t\t\t40,\n\t\t\t41,\n\t\t\t42,\n\t\t\t43,\n\t\t\t44,\n\t\t\t45,\n\t\t\t56,\n\t\t\t57,\n\t\t\t62,\n\t\t\t63,\n\t\t\t68,\n\t\t\t69,\n\t\t\t74,\n\t\t\t75,\n\t\t\t76,\n\t\t\t77,\n\t\t\t78,\n\t\t\t79,\n\t\t\t80,\n\t\t\t81,\n\t\t\t92,\n\t\t\t93,\n\t\t\t98,\n\t\t\t99,\n\t\t\t112,\n\t\t\t113,\n\t\t\t128,\n\t\t\t129,\n\t\t\t134,\n\t\t\t135,\n\t\t\t148,\n\t\t\t149,\n\t\t\t160,\n\t\t\t161,\n\t\t\t162,\n\t\t\t163,\n\t\t\t164,\n\t\t\t165,\n\t\t\t166,\n\t\t\t167,\n\t\t\t168,\n\t\t\t169,\n\t\t\t170,\n\t\t\t171,\n\t\t\t172,\n\t\t\t173,\n\t\t\t178,\n\t\t\t179,\n\t\t\t184,\n\t\t\t185,\n\t\t\t196,\n\t\t\t197,\n\t\t\t198,\n\t\t\t199,\n\t\t\t200,\n\t\t\t201,\n\t\t\t202,\n\t\t\t203,\n\t\t\t204,\n\t\t\t205,\n\t\t\t206,\n\t\t\t207,\n\t\t\t208,\n\t\t\t209,\n\t\t\t214,\n\t\t\t215,\n\t\t\t220,\n\t\t\t221\n\t\t];\n\t}\n} catch (error) {\n\t// Swallow - we only care if `supports-color` is available; it doesn't have to be.\n}\n\n/**\n * Build up the default `inspectOpts` object from the environment variables.\n *\n *   $ DEBUG_COLORS=no DEBUG_DEPTH=10 DEBUG_SHOW_HIDDEN=enabled node script.js\n */\n\nexports.inspectOpts = Object.keys(process.env).filter(key => {\n\treturn /^debug_/i.test(key);\n}).reduce((obj, key) => {\n\t// Camel-case\n\tconst prop = key\n\t\t.substring(6)\n\t\t.toLowerCase()\n\t\t.replace(/_([a-z])/g, (_, k) => {\n\t\t\treturn k.toUpperCase();\n\t\t});\n\n\t// Coerce string value into JS value\n\tlet val = process.env[key];\n\tif (/^(yes|on|true|enabled)$/i.test(val)) {\n\t\tval = true;\n\t} else if (/^(no|off|false|disabled)$/i.test(val)) {\n\t\tval = false;\n\t} else if (val === 'null') {\n\t\tval = null;\n\t} else {\n\t\tval = Number(val);\n\t}\n\n\tobj[prop] = val;\n\treturn obj;\n}, {});\n\n/**\n * Is stdout a TTY? Colored output is enabled when `true`.\n */\n\nfunction useColors() {\n\treturn 'colors' in exports.inspectOpts ?\n\t\tBoolean(exports.inspectOpts.colors) :\n\t\ttty.isatty(process.stderr.fd);\n}\n\n/**\n * Adds ANSI color escape codes if enabled.\n *\n * @api public\n */\n\nfunction formatArgs(args) {\n\tconst {namespace: name, useColors} = this;\n\n\tif (useColors) {\n\t\tconst c = this.color;\n\t\tconst colorCode = '\\u001B[3' + (c < 8 ? c : '8;5;' + c);\n\t\tconst prefix = `  ${colorCode};1m${name} \\u001B[0m`;\n\n\t\targs[0] = prefix + args[0].split('\\n').join('\\n' + prefix);\n\t\targs.push(colorCode + 'm+' + module.exports.humanize(this.diff) + '\\u001B[0m');\n\t} else {\n\t\targs[0] = getDate() + name + ' ' + args[0];\n\t}\n}\n\nfunction getDate() {\n\tif (exports.inspectOpts.hideDate) {\n\t\treturn '';\n\t}\n\treturn new Date().toISOString() + ' ';\n}\n\n/**\n * Invokes `util.format()` with the specified arguments and writes to stderr.\n */\n\nfunction log(...args) {\n\treturn process.stderr.write(util.format(...args) + '\\n');\n}\n\n/**\n * Save `namespaces`.\n *\n * @param {String} namespaces\n * @api private\n */\nfunction save(namespaces) {\n\tif (namespaces) {\n\t\tprocess.env.DEBUG = namespaces;\n\t} else {\n\t\t// If you set a process.env field to null or undefined, it gets cast to the\n\t\t// string 'null' or 'undefined'. Just delete instead.\n\t\tdelete process.env.DEBUG;\n\t}\n}\n\n/**\n * Load `namespaces`.\n *\n * @return {String} returns the previously persisted debug modes\n * @api private\n */\n\nfunction load() {\n\treturn process.env.DEBUG;\n}\n\n/**\n * Init logic for `debug` instances.\n *\n * Create a new `inspectOpts` object in case `useColors` is set\n * differently for a particular `debug` instance.\n */\n\nfunction init(debug) {\n\tdebug.inspectOpts = {};\n\n\tconst keys = Object.keys(exports.inspectOpts);\n\tfor (let i = 0; i < keys.length; i++) {\n\t\tdebug.inspectOpts[keys[i]] = exports.inspectOpts[keys[i]];\n\t}\n}\n\nmodule.exports = require('./common')(exports);\n\nconst {formatters} = module.exports;\n\n/**\n * Map %o to `util.inspect()`, all on a single line.\n */\n\nformatters.o = function (v) {\n\tthis.inspectOpts.colors = this.useColors;\n\treturn util.inspect(v, this.inspectOpts)\n\t\t.split('\\n')\n\t\t.map(str => str.trim())\n\t\t.join(' ');\n};\n\n/**\n * Map %O to `util.inspect()`, allowing multiple lines if needed.\n */\n\nformatters.O = function (v) {\n\tthis.inspectOpts.colors = this.useColors;\n\treturn util.inspect(v, this.inspectOpts);\n};\n","'use strict';\n\nmodule.exports = (flag, argv = process.argv) => {\n\tconst prefix = flag.startsWith('-') ? '' : (flag.length === 1 ? '-' : '--');\n\tconst position = argv.indexOf(prefix + flag);\n\tconst terminatorPosition = argv.indexOf('--');\n\treturn position !== -1 && (terminatorPosition === -1 || position < terminatorPosition);\n};\n","/**\n * Helpers.\n */\n\nvar s = 1000;\nvar m = s * 60;\nvar h = m * 60;\nvar d = h * 24;\nvar w = d * 7;\nvar y = d * 365.25;\n\n/**\n * Parse or format the given `val`.\n *\n * Options:\n *\n *  - `long` verbose formatting [false]\n *\n * @param {String|Number} val\n * @param {Object} [options]\n * @throws {Error} throw an error if val is not a non-empty string or a number\n * @return {String|Number}\n * @api public\n */\n\nmodule.exports = function(val, options) {\n  options = options || {};\n  var type = typeof val;\n  if (type === 'string' && val.length > 0) {\n    return parse(val);\n  } else if (type === 'number' && isFinite(val)) {\n    return options.long ? fmtLong(val) : fmtShort(val);\n  }\n  throw new Error(\n    'val is not a non-empty string or a valid number. val=' +\n      JSON.stringify(val)\n  );\n};\n\n/**\n * Parse the given `str` and return milliseconds.\n *\n * @param {String} str\n * @return {Number}\n * @api private\n */\n\nfunction parse(str) {\n  str = String(str);\n  if (str.length > 100) {\n    return;\n  }\n  var match = /^(-?(?:\\d+)?\\.?\\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(\n    str\n  );\n  if (!match) {\n    return;\n  }\n  var n = parseFloat(match[1]);\n  var type = (match[2] || 'ms').toLowerCase();\n  switch (type) {\n    case 'years':\n    case 'year':\n    case 'yrs':\n    case 'yr':\n    case 'y':\n      return n * y;\n    case 'weeks':\n    case 'week':\n    case 'w':\n      return n * w;\n    case 'days':\n    case 'day':\n    case 'd':\n      return n * d;\n    case 'hours':\n    case 'hour':\n    case 'hrs':\n    case 'hr':\n    case 'h':\n      return n * h;\n    case 'minutes':\n    case 'minute':\n    case 'mins':\n    case 'min':\n    case 'm':\n      return n * m;\n    case 'seconds':\n    case 'second':\n    case 'secs':\n    case 'sec':\n    case 's':\n      return n * s;\n    case 'milliseconds':\n    case 'millisecond':\n    case 'msecs':\n    case 'msec':\n    case 'ms':\n      return n;\n    default:\n      return undefined;\n  }\n}\n\n/**\n * Short format for `ms`.\n *\n * @param {Number} ms\n * @return {String}\n * @api private\n */\n\nfunction fmtShort(ms) {\n  var msAbs = Math.abs(ms);\n  if (msAbs >= d) {\n    return Math.round(ms / d) + 'd';\n  }\n  if (msAbs >= h) {\n    return Math.round(ms / h) + 'h';\n  }\n  if (msAbs >= m) {\n    return Math.round(ms / m) + 'm';\n  }\n  if (msAbs >= s) {\n    return Math.round(ms / s) + 's';\n  }\n  return ms + 'ms';\n}\n\n/**\n * Long format for `ms`.\n *\n * @param {Number} ms\n * @return {String}\n * @api private\n */\n\nfunction fmtLong(ms) {\n  var msAbs = Math.abs(ms);\n  if (msAbs >= d) {\n    return plural(ms, msAbs, d, 'day');\n  }\n  if (msAbs >= h) {\n    return plural(ms, msAbs, h, 'hour');\n  }\n  if (msAbs >= m) {\n    return plural(ms, msAbs, m, 'minute');\n  }\n  if (msAbs >= s) {\n    return plural(ms, msAbs, s, 'second');\n  }\n  return ms + ' ms';\n}\n\n/**\n * Pluralization helper.\n */\n\nfunction plural(ms, msAbs, n, name) {\n  var isPlural = msAbs >= n * 1.5;\n  return Math.round(ms / n) + ' ' + name + (isPlural ? 's' : '');\n}\n","'use strict';\nconst os = require('os');\nconst tty = require('tty');\nconst hasFlag = require('has-flag');\n\nconst {env} = process;\n\nlet flagForceColor;\nif (hasFlag('no-color') ||\n\thasFlag('no-colors') ||\n\thasFlag('color=false') ||\n\thasFlag('color=never')) {\n\tflagForceColor = 0;\n} else if (hasFlag('color') ||\n\thasFlag('colors') ||\n\thasFlag('color=true') ||\n\thasFlag('color=always')) {\n\tflagForceColor = 1;\n}\n\nfunction envForceColor() {\n\tif ('FORCE_COLOR' in env) {\n\t\tif (env.FORCE_COLOR === 'true') {\n\t\t\treturn 1;\n\t\t}\n\n\t\tif (env.FORCE_COLOR === 'false') {\n\t\t\treturn 0;\n\t\t}\n\n\t\treturn env.FORCE_COLOR.length === 0 ? 1 : Math.min(Number.parseInt(env.FORCE_COLOR, 10), 3);\n\t}\n}\n\nfunction translateLevel(level) {\n\tif (level === 0) {\n\t\treturn false;\n\t}\n\n\treturn {\n\t\tlevel,\n\t\thasBasic: true,\n\t\thas256: level >= 2,\n\t\thas16m: level >= 3\n\t};\n}\n\nfunction supportsColor(haveStream, {streamIsTTY, sniffFlags = true} = {}) {\n\tconst noFlagForceColor = envForceColor();\n\tif (noFlagForceColor !== undefined) {\n\t\tflagForceColor = noFlagForceColor;\n\t}\n\n\tconst forceColor = sniffFlags ? flagForceColor : noFlagForceColor;\n\n\tif (forceColor === 0) {\n\t\treturn 0;\n\t}\n\n\tif (sniffFlags) {\n\t\tif (hasFlag('color=16m') ||\n\t\t\thasFlag('color=full') ||\n\t\t\thasFlag('color=truecolor')) {\n\t\t\treturn 3;\n\t\t}\n\n\t\tif (hasFlag('color=256')) {\n\t\t\treturn 2;\n\t\t}\n\t}\n\n\tif (haveStream && !streamIsTTY && forceColor === undefined) {\n\t\treturn 0;\n\t}\n\n\tconst min = forceColor || 0;\n\n\tif (env.TERM === 'dumb') {\n\t\treturn min;\n\t}\n\n\tif (process.platform === 'win32') {\n\t\t// Windows 10 build 10586 is the first Windows release that supports 256 colors.\n\t\t// Windows 10 build 14931 is the first release that supports 16m/TrueColor.\n\t\tconst osRelease = os.release().split('.');\n\t\tif (\n\t\t\tNumber(osRelease[0]) >= 10 &&\n\t\t\tNumber(osRelease[2]) >= 10586\n\t\t) {\n\t\t\treturn Number(osRelease[2]) >= 14931 ? 3 : 2;\n\t\t}\n\n\t\treturn 1;\n\t}\n\n\tif ('CI' in env) {\n\t\tif (['TRAVIS', 'CIRCLECI', 'APPVEYOR', 'GITLAB_CI', 'GITHUB_ACTIONS', 'BUILDKITE', 'DRONE'].some(sign => sign in env) || env.CI_NAME === 'codeship') {\n\t\t\treturn 1;\n\t\t}\n\n\t\treturn min;\n\t}\n\n\tif ('TEAMCITY_VERSION' in env) {\n\t\treturn /^(9\\.(0*[1-9]\\d*)\\.|\\d{2,}\\.)/.test(env.TEAMCITY_VERSION) ? 1 : 0;\n\t}\n\n\tif (env.COLORTERM === 'truecolor') {\n\t\treturn 3;\n\t}\n\n\tif ('TERM_PROGRAM' in env) {\n\t\tconst version = Number.parseInt((env.TERM_PROGRAM_VERSION || '').split('.')[0], 10);\n\n\t\tswitch (env.TERM_PROGRAM) {\n\t\t\tcase 'iTerm.app':\n\t\t\t\treturn version >= 3 ? 3 : 2;\n\t\t\tcase 'Apple_Terminal':\n\t\t\t\treturn 2;\n\t\t\t// No default\n\t\t}\n\t}\n\n\tif (/-256(color)?$/i.test(env.TERM)) {\n\t\treturn 2;\n\t}\n\n\tif (/^screen|^xterm|^vt100|^vt220|^rxvt|color|ansi|cygwin|linux/i.test(env.TERM)) {\n\t\treturn 1;\n\t}\n\n\tif ('COLORTERM' in env) {\n\t\treturn 1;\n\t}\n\n\treturn min;\n}\n\nfunction getSupportLevel(stream, options = {}) {\n\tconst level = supportsColor(stream, {\n\t\tstreamIsTTY: stream && stream.isTTY,\n\t\t...options\n\t});\n\n\treturn translateLevel(level);\n}\n\nmodule.exports = {\n\tsupportsColor: getSupportLevel,\n\tstdout: getSupportLevel({isTTY: tty.isatty(1)}),\n\tstderr: getSupportLevel({isTTY: tty.isatty(2)})\n};\n","module.exports = require(\"electron\");","module.exports = require(\"events\");","module.exports = require(\"fs\");","module.exports = require(\"node:path\");","module.exports = require(\"node:url\");","module.exports = require(\"os\");","module.exports = require(\"path\");","module.exports = require(\"tty\");","module.exports = require(\"util\");","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","export * from './browser'\n"],"names":["Menu","MenuItem","protocol","nativeImage","app","PopupView","getExtensionUrl","getExtensionManifest","getIconPath","resolveExtensionPath","matchSize","ResizeType","debug","require","isReady","registerSchemesAsPrivileged","scheme","privileges","bypassCSP","getBrowserActionDefaults","extension","manifest","browser_action","action","title","default_title","name","iconPath","icon","path","default_popup","popup","BrowserActionAPI","constructor","ctx","actionMap","Map","observers","Set","queuedUpdate","handleCrxRequest","request","callback","url","response","URL","hostname","requestType","tabId","searchParams","get","fragments","pathname","split","extensionId","imageSize","parseInt","resizeType","Up","session","getExtension","iconDetails","_action$tabs$tabId","tabs","iconImage","iconAbsPath","createFromPath","imagePath","imageData","createFromDataURL","undefined","statusCode","mimeType","data","toPNG","e","console","error","handle","router","apiHandler","getter","propName","details","getAction","id","result","setDetails","value","defaults","valueObj","tabAction","Object","assign","onUpdate","setter","event","handleProp","prop","key","iconModified","Date","now","preloadOpts","allowRemote","extensionContext","getState","bind","activate","sender","webContents","add","once","delete","store","on","actionDetails","setupSession","processExtension","removeActions","registerBufferProtocol","set","has","getPopupUrl","_action$tabs$tabId2","popupPath","defaultAction","actions","Array","from","entries","map","rest","tabsInfo","keys","activeTab","getActiveTabOfCurrentWindow","activeTabId","extEvt","eventType","activateClick","activateContextMenu","anchorRect","toggleExtension","isDestroyed","destroy","tab","getTabById","Error","popupUrl","win","tabToWindow","parent","emit","tabDetails","tabDetailsCache","sendEvent","_manifest$options_ui","menu","append","opts","appendSeparator","type","label","click","homePageUrl","homepage_url","createTab","contextMenuItems","buildMenuItems","length","forEach","item","optionsPage","options_page","options_ui","page","optionsPageUrl","enabled","x","Math","floor","y","height","queueMicrotask","size","observer","send","CommandsAPI","getAll","promises","fs","uri","href","relpath","indexOf","slice","resPath","join","startsWith","validateExtensionResource","stat","imageSet","match","first","pop","iconSize","icons","default_icon","getIconImage","iconAbsolutePath","escapePattern","pattern","replace","matchesPattern","regexp","RegExp","DEFAULT_CONTEXTS","getContextTypesFromParams","params","contexts","mediaType","pageURL","linkURL","frameURL","selectionText","isEditable","formatTitle","includes","matchesConditions","props","conditions","visible","contextTypes","targetUrl","documentUrl","inContext","some","context","targetUrlPatterns","documentUrlPatterns","ContextMenusAPI","menus","buildMenuItem","showIcon","resize","width","menuItemOptions","onClicked","buildMenuItemsFromTemplate","menuItemTemplates","itemMap","menuItem","parentId","parentMenuItem","submenu","push","menuItems","buildFromTemplate","isArray","create","createProperties","addContextItem","remove","menuItemId","items","removeAll","buildMenuItemsForExtension","contextItems","buildMenuItemsForParams","srcURL","propItems","menuType","extensionItems","checked","frameId","frameUrl","editable","wasChecked","pageUrl","linkUrl","parentMenuItemId","srcUrl","CookieStoreID","onChangedCauseTranslation","createCookieDetails","cookie","domain","hostOnly","Boolean","httpOnly","secure","storeId","Default","CookiesAPI","cookies","onChanged","cause","removed","changeInfo","broadcastEvent","getAllCookieStores","addListener","tabIds","filter","Notification","TemplateType","getBody","Basic","List","message","getUrgency","priority","createScopedIdentifier","stripScopeFromIdentifier","index","substr","NotificationsAPI","registry","clear","notificationId","_this$registry$get","close","arg1","arg2","iconUrl","_this$registry$get2","_url","notification","subtitle","body","silent","urgency","timeoutType","requireInteraction","byUser","show","getPermissionLevel","isSupported","update","EventEmitter","RuntimeAPI","openOptionsPage","active","parse","BrowserWindow","ensureSuffix","WindowsAPI","TabsAPI","getAllInWindow","getCurrent","insertCSS","query","reload","goForward","goBack","observeTab","updateEvents","updateHandler","onUpdated","eventName","faviconHandler","favicons","favicon","off","removeTab","onRemoved","onCreated","onActivated","getType","getURL","createTabDetails","_win","getActiveTabFromWebContents","getSize","audible","isCurrentlyAudible","autoDiscardable","discarded","favIconUrl","highlighted","incognito","mutedInfo","muted","audioMuted","pinned","selected","status","isLoading","getTitle","windowId","impl","assignTabDetails","getTabDetails","TAB_ID_NONE","WINDOW_ID_CURRENT","lastFocusedWindowId","browserWindow","urlInfo","baseURL","posix","code","info","isSet","lastFocusedWindow","getLastFocusedWindow","currentWin","windowsGetCurrent","filteredTabs","_tab$mutedInfo","currentWindow","reloadProperties","bypassCache","reloadIgnoringCache","updateProperties","loadURL","setAudioMuted","ids","prevDetails","compareProps","didUpdate","WINDOW_ID_NONE","getAllWindows","find","isWindowClosing","activeChanged","setActiveTab","tabInfo","cacheTabId","electron","getFrame","frameProcessId","frameRoutingId","webFrameMain","fromId","getFrameId","frame","top","frameTreeNodeId","getParentFrameId","parentFrame","getFrameDetails","errorOccurred","processId","parentFrameId","WebNavigationAPI","sendNavigationEvent","onCreatedNavigationTarget","isInPlace","isMainFrame","sourceTabId","sourceProcessId","sourceFrameId","timeStamp","onBeforeNavigate","onCommitted","httpResponseCode","httpStatusText","onHistoryStateUpdated","transitionType","transitionQualifiers","onDOMContentLoaded","isLoadingMainFrame","onFinishLoad","getAllFrames","mainFrame","targetFrame","framesInSubtree","unPrefix","getWindowState","isMaximized","isMinimized","isFullScreen","getLastFocused","observeWindow","window","onFocus","onFocusChanged","onClosed","windowDetailsCache","removeWindow","onRestoreOrMove","getWindowDetails","state","onMinimize","onMaximize","onEnterFullscreen","onLeaveFullscreen","process","platform","createWindowDetails","focused","isFocused","getPosition","left","ownerWindow","isPersistent","alwaysOnTop","isAlwaysOnTop","sessionId","getWindowFromId","getWindowById","lastFocusedWin","windows","createWindow","maximize","minimize","fullScreenable","setFullScreen","warn","restore","removedWindowId","findWindowById","windowDetails","electronSession","ExtensionStore","ExtensionRouter","sessionMap","WeakMap","ElectronChromeExtensions","fromSession","modulePath","preloadPath","api","defaultSession","__dirname","browserAction","contextMenus","commands","notifications","runtime","webNavigation","prependPreload","preloads","getPreloads","preloadIndex","splice","setPreloads","preloadExists","isFile","addTab","addWindow","selectTab","addExtensionHost","host","getContextMenuItems","addExtension","removeExtension","Extensions","destroyed","usingPreferredSize","readyPromise","isDevToolsOpened","closeDevTools","maybeClose","_this$browserWindow","_this$browserWindow2","getFocusedWindow","updatePreferredSize","setSize","updatePosition","movable","maximizable","minimizable","resizable","skipTaskbar","backgroundColor","webPreferences","sandbox","nodeIntegration","nodeIntegrationInWorker","nativeWindowOpen","worldSafeExecuteJavaScript","contextIsolation","enablePreferredSizeMode","untypedWebContents","load","BOUNDS","maxWidth","maxHeight","Promise","resolve","setTimeout","queryPreferredSize","whenReady","rect","_this$browserWindow3","min","max","minWidth","minHeight","setBounds","getBounds","winBounds","viewBounds","POSITION_PADDING","executeJavaScript","document","getBoundingClientRect","ipcMain","createDebug","formatIpcName","shortenValues","k","v","formatters","r","JSON","stringify","DEFAULT_SESSION","gRoutingDelegate","RoutingDelegate","onRouterMessage","handlerName","args","onExtensionMessage","onRemoteMessage","sessionPartition","ses","fromPartition","onAddListener","listener","onRemoveListener","removeListener","addObserver","eventListenerEquals","eventListener","other","delegate","handlers","listeners","extensionHosts","filterListeners","predicate","filteredListeners","delta","observeListenerHost","eventListeners","existingEventListener","findIndex","getHandler","handler","extEvent","_eventListeners","el","windowToActiveTab","_this$impl$getWindowB","_this$impl","foundWindow","call","wc","fromWebContents","_this$impl$getTabbedB","_this$impl2","behaviors","getTabbedBrowserWindowBehavior","windowHasTabs","keepRefWindowOnAllTabsClosed","getActiveTabFromWindow","prevActiveTab","str","suffix","endsWith","prefix","prefixes","ret"],"sourceRoot":""}